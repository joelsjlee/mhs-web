<!DOCTYPE html>
<html>

<head>
  <title>JQA Timeline</title>
  <meta charset="utf-8">
  <script src="http://cdnjs.cloudflare.com/ajax/libs/d3/5.9.0/d3.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
  <script src="../../../JsScripts/gtime/dist/d3-gtimeline.full.umd.cjs" type="text/javascript"></script>
  <link rel="stylesheet" href="../../../styles/oldstyles.css"></link>
  <style type="text/css">
    div.tooltip {
      position: absolute;
      text-align: center;
      padding: 5px;
      font: 12px sans-serif;
      background: white;
      border: 1px solid #AAA;
      border-radius: 2px;
      pointer-events: none;
    }
  </style>
</head>

<body>
	<header id="menu">
		<script src="../../../styles/menu.js?v1"></script>
	</header>
	
	<div class="main-body">

  <h1 class = "title">Timeline Chart</h1>
  
  <label for="sorttype">Sort By.. :</label>

  <select name="sorttype" id="sorttype">
	<option value="Time">Time</option>
	<option value="Category">Category</option>
  </select>
 
 
  <div id="chart"></div>

  
  <script>

	Redraw()
	
	// Function to create the timeline chart
	function drawChart(data) {
		// Creating the timeline chart
		let colorArray = (d3.schemeSet3.slice(0, 100))

	// removes a super ugly color 
	colorArray.splice(1,1);


		const chart = d3.timeline().duration(500);
		chart.colors(colorArray);

		// Select the div with id 'chart' and apply the data to it
		d3.selectAll('#chart').datum(data).call(chart);
	}

	// Function to transform the CSV data into the format needed for the timeline
	function transformData(data) {
		return data.map(d => [
			d.role,
			d.name,
			new Date(d.start),
			new Date(d.end)
		]);
	}

	function Redraw(){
		if (document.getElementById("sorttype").value == "Time") {
	// Load the CSV file asynchronously
	d3.csv("../../../data/timeline/timeline.csv", function(row) {
		return {
			role: row.Role,
			name: row.Name,
			start: new Date(row.Start),
			end: new Date(row.End)
		};
	}).then(function(data) {
		// Transform the data into the format needed by the timeline
		const transformedData = transformData(data);

		
		// After the data is transformed, draw the chart
		drawChart(transformedData);

	}).catch(function(error) {
		console.error("Error loading the CSV file:", error);
	});

}

else if (document.getElementById("sorttype").value == "Category") {
	// Load the CSV file asynchronously
	d3.csv("../../../data/timeline/sortedtimeline.csv", function(row) {
		return {
			role: row.Role,
			name: row.Name,
			start: new Date(row.Start),
			end: new Date(row.End)
		};
	}).then(function(data) {
		// Transform the data into the format needed by the timeline
		const transformedData = transformData(data);

		
		// After the data is transformed, draw the chart
		drawChart(transformedData);

	}).catch(function(error) {
		console.error("Error loading the CSV file:", error);
	});

}


	}

	document.getElementById("sorttype").addEventListener("change", function() {
  Redraw();  // Call your function with the selected value
});

	

/*
	var Ystart = 1794;


	StartDateStr = String(Ystart) + "01" + "01";
	console.log(StartDateStr);

	var Yend = 1798

	EndDateStr = String(Yend) + "12" + "30";
	console.log(EndDateStr);

	var subjecttitle = "American Revolution"

	SearchSubject = subjecttitle.replace(" ","%20")

	console.log("https://www.primarysourcecoop.org/publications/jqa/search#q%3D%2Bsubject%3A%22"+SearchSubject+"%22%20%2Bdate_when%3A%5B"+StartDateStr+"%20TO%20"+EndDateStr+"%5D%7Crows=20%7Cstart=0%7Chl=true%7Chl.fl=text_merge%7Csort=date_when%20asc%7Cff=person_keyword;subject%7Cfl=id%20index%20title%20filename%20resource_group_name%20date_when%20date_to%20author%20recipient%20person_keyword%20subject%20doc_beginning")
*/ 
</script>

</div>

</body>

</html>