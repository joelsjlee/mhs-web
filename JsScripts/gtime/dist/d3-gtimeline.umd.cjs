(function(O,z){typeof exports=="object"&&typeof module<"u"?z(exports,require("d3"),require("dayjs")):typeof define=="function"&&define.amd?define(["exports","d3","dayjs"],z):(O=typeof globalThis<"u"?globalThis:O||self,z(O.d3=O.d3||{},O.d3,O.dayjs))})(this,function(O,z,U){"use strict";function xt(e){const r=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const d in e)if(d!=="default"){const p=Object.getOwnPropertyDescriptor(e,d);Object.defineProperty(r,d,p.get?p:{enumerable:!0,get:()=>e[d]})}}return r.default=e,Object.freeze(r)}const c=xt(z),yt="div.tooltip {        position: absolute;        text-align: center;        padding: 5px;        /* font: 12px sans-serif; */        background: white;        border: 1px solid #AAA;        border-radius: 2px;        pointer-events: none;      }";function tt(e){c.select("head").selectAll("#tooltip").data([1]).enter().append("style").attr("id","tooltip").text(yt);const r=c.select("body").append("div").attr("class","tooltip").style("opacity",0);return r.show=function(d){r.transition().duration(100).style("opacity",.95),r.html(e.apply(null,arguments)).style("left",d.pageX+"px").style("top",d.pageY-28+"px")},r.hide=function(d){r.transition().duration(100).style("opacity",0)},r}function wt(e){return c.max(e.nodes().map(r=>r.getComputedTextLength()))}function bt(e){return function(r){return r.length>e?r.slice(0,e-1)+"â€¦":r}}const L=1,$t=2;function ot(e,r){let d=["#FFF","#EEE"],p=c.scaleOrdinal(d),M=5,v,H="#AAA",E=40,S=3e3,i;function a(u){let D=r.domain(),C=tt(s=>s),B=c.scaleOrdinal(d),P=c.scaleOrdinal(d.reverse()),y=bt(E),_=u.selectAll(".row").data(D,r).order(),l=_.enter().append("g").attr("class","row"),g=_.exit(),f=_.select("text");_=_.merge(l).attr("transform",s=>"translate(0,"+r(s)+")"),g.remove(),l.append("rect").attr("y",.5).attr("width",S).attr("height",r.bandwidth()).attr("stroke",H).attr("stroke-width",.75).attr("fill",B),l.append("path").attr("stroke",P),f=f.merge(l.append("text").attr("y",r.bandwidth()/2).attr("dy","0.32em").on("mouseover",function(s,n){c.select(this).text()!=n&&C.show(n)}).on("mouseout",C.hide)).text(y),i===void 0&&(i=wt(f)+2*M,i=e===L?S-i:i),v=e===L?[0,i]:[i,S],f.attr("text-anchor",e===L?"start":"end").attr("dx",e===L?M:-M).attr("x",i);const $=function(s,n){i=Math.max(10,Math.min(S-10,i+s.dx)),c.select(this).attr("d","M"+i+",0.5V"+r.range()[1]),f.attr("x",i),v=e===L?[0,i]:[i,S],u.dispatch("offset",{detail:{offset:i}})};u.selectAll("g.y.axis > path").data([1]).join("path").attr("stroke",H).attr("stroke-width",1.75).attr("d","M"+(i+.5)+",0.5V"+r.range()[1]).style("cursor","ew-resize").call(c.drag().on("drag",$))}return a.draw_ticks=function(u,D){u.selectAll(".row").select("path").attr("d",D.map(C=>"M"+C+",1v"+(r.bandwidth()-1)).join(""))},a.scale=function(u){return arguments.length?(r=u,a):r},a.width=function(u){return arguments.length?(S=u,a):S},a.colors=function(u){return arguments.length?(d=u,a):d},a.padding=function(u){return arguments.length?(M=u,a):M},a.range=function(u){return arguments.length?(v=u,a):v},a.trim=function(u){return arguments.length?(E=u,a):E},a.offset=function(u){return arguments.length?(i=u,a):i},a.colorscale=function(u){return arguments.length?(p=u,a):p},a}function it(e){return ot($t,e)}function at(e){return ot(L,e)}var ct=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function lt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ut={exports:{}};(function(e,r){(function(d,p){e.exports=p()})(ct,function(){var d,p,M=1e3,v=6e4,H=36e5,E=864e5,S=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,i=31536e6,a=2628e6,u=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,D={years:i,months:a,days:E,hours:H,minutes:v,seconds:M,milliseconds:1,weeks:6048e5},C=function(s){return s instanceof f},B=function(s,n,t){return new f(s,t,n.$l)},P=function(s){return p.p(s)+"s"},y=function(s){return s<0},_=function(s){return y(s)?Math.ceil(s):Math.floor(s)},l=function(s){return Math.abs(s)},g=function(s,n){return s?y(s)?{negative:!0,format:""+l(s)+n}:{negative:!1,format:""+s+n}:{negative:!1,format:""}},f=function(){function s(t,m,x){var h=this;if(this.$d={},this.$l=x,t===void 0&&(this.$ms=0,this.parseFromMilliseconds()),m)return B(t*D[P(m)],this);if(typeof t=="number")return this.$ms=t,this.parseFromMilliseconds(),this;if(typeof t=="object")return Object.keys(t).forEach(function(F){h.$d[P(F)]=t[F]}),this.calMilliseconds(),this;if(typeof t=="string"){var A=t.match(u);if(A){var j=A.slice(2).map(function(F){return F!=null?Number(F):0});return this.$d.years=j[0],this.$d.months=j[1],this.$d.weeks=j[2],this.$d.days=j[3],this.$d.hours=j[4],this.$d.minutes=j[5],this.$d.seconds=j[6],this.calMilliseconds(),this}}return this}var n=s.prototype;return n.calMilliseconds=function(){var t=this;this.$ms=Object.keys(this.$d).reduce(function(m,x){return m+(t.$d[x]||0)*D[x]},0)},n.parseFromMilliseconds=function(){var t=this.$ms;this.$d.years=_(t/i),t%=i,this.$d.months=_(t/a),t%=a,this.$d.days=_(t/E),t%=E,this.$d.hours=_(t/H),t%=H,this.$d.minutes=_(t/v),t%=v,this.$d.seconds=_(t/M),t%=M,this.$d.milliseconds=t},n.toISOString=function(){var t=g(this.$d.years,"Y"),m=g(this.$d.months,"M"),x=+this.$d.days||0;this.$d.weeks&&(x+=7*this.$d.weeks);var h=g(x,"D"),A=g(this.$d.hours,"H"),j=g(this.$d.minutes,"M"),F=this.$d.seconds||0;this.$d.milliseconds&&(F+=this.$d.milliseconds/1e3,F=Math.round(1e3*F)/1e3);var R=g(F,"S"),nt=t.negative||m.negative||h.negative||A.negative||j.negative||R.negative,Q=A.format||j.format||R.format?"T":"",Z=(nt?"-":"")+"P"+t.format+m.format+h.format+Q+A.format+j.format+R.format;return Z==="P"||Z==="-P"?"P0D":Z},n.toJSON=function(){return this.toISOString()},n.format=function(t){var m=t||"YYYY-MM-DDTHH:mm:ss",x={Y:this.$d.years,YY:p.s(this.$d.years,2,"0"),YYYY:p.s(this.$d.years,4,"0"),M:this.$d.months,MM:p.s(this.$d.months,2,"0"),D:this.$d.days,DD:p.s(this.$d.days,2,"0"),H:this.$d.hours,HH:p.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:p.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:p.s(this.$d.seconds,2,"0"),SSS:p.s(this.$d.milliseconds,3,"0")};return m.replace(S,function(h,A){return A||String(x[h])})},n.as=function(t){return this.$ms/D[P(t)]},n.get=function(t){var m=this.$ms,x=P(t);return x==="milliseconds"?m%=1e3:m=x==="weeks"?_(m/D[x]):this.$d[x],m||0},n.add=function(t,m,x){var h;return h=m?t*D[P(m)]:C(t)?t.$ms:B(t,this).$ms,B(this.$ms+h*(x?-1:1),this)},n.subtract=function(t,m){return this.add(t,m,!0)},n.locale=function(t){var m=this.clone();return m.$l=t,m},n.clone=function(){return B(this.$ms,this)},n.humanize=function(t){return d().add(this.$ms,"ms").locale(this.$l).fromNow(!t)},n.valueOf=function(){return this.asMilliseconds()},n.milliseconds=function(){return this.get("milliseconds")},n.asMilliseconds=function(){return this.as("milliseconds")},n.seconds=function(){return this.get("seconds")},n.asSeconds=function(){return this.as("seconds")},n.minutes=function(){return this.get("minutes")},n.asMinutes=function(){return this.as("minutes")},n.hours=function(){return this.get("hours")},n.asHours=function(){return this.as("hours")},n.days=function(){return this.get("days")},n.asDays=function(){return this.as("days")},n.weeks=function(){return this.get("weeks")},n.asWeeks=function(){return this.as("weeks")},n.months=function(){return this.get("months")},n.asMonths=function(){return this.as("months")},n.years=function(){return this.get("years")},n.asYears=function(){return this.as("years")},s}(),$=function(s,n,t){return s.add(n.years()*t,"y").add(n.months()*t,"M").add(n.days()*t,"d").add(n.hours()*t,"h").add(n.minutes()*t,"m").add(n.seconds()*t,"s").add(n.milliseconds()*t,"ms")};return function(s,n,t){d=t,p=t().$utils(),t.duration=function(h,A){var j=t.locale();return B(h,{$l:j},A)},t.isDuration=C;var m=n.prototype.add,x=n.prototype.subtract;n.prototype.add=function(h,A){return C(h)?$(this,h,1):m.bind(this)(h,A)},n.prototype.subtract=function(h,A){return C(h)?$(this,h,-1):x.bind(this)(h,A)}}})})(ut);var vt=ut.exports;const At=lt(vt);var dt={exports:{}};(function(e,r){(function(d,p){e.exports=p()})(ct,function(){return function(d,p,M){d=d||{};var v=p.prototype,H={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function E(i,a,u,D){return v.fromToBase(i,a,u,D)}M.en.relativeTime=H,v.fromToBase=function(i,a,u,D,C){for(var B,P,y,_=u.$locale().relativeTime||H,l=d.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],g=l.length,f=0;f<g;f+=1){var $=l[f];$.d&&(B=D?M(i).diff(u,$.d,!0):u.diff(i,$.d,!0));var s=(d.rounding||Math.round)(Math.abs(B));if(y=B>0,s<=$.r||!$.r){s<=1&&f>0&&($=l[f-1]);var n=_[$.l];C&&(s=C(""+s)),P=typeof n=="string"?n.replace("%d",s):n(s,a,$.l,y);break}}if(a)return P;var t=y?_.future:_.past;return typeof t=="function"?t(P):t.replace("%s",P)},v.to=function(i,a){return E(i,a,this,!0)},v.from=function(i,a){return E(i,a,this)};var S=function(i){return i.$u?M.utc():M()};v.toNow=function(i){return this.to(S(this),i)},v.fromNow=function(i){return this.from(S(this),i)}}})})(dt);var kt=dt.exports;const Mt=lt(kt);U.extend(At),U.extend(Mt);function ht(e,r){return U.duration(r-e).humanize()}function et(){const e=Array.prototype.slice.call(arguments,0);return function(r){return e.reduce((d,p)=>p(d),r)}}function K(e){return function(r){return e===void 0?r:r[e]}}const St=["#4285f4","#db4437","#f4b400","#0f9d58","#ab47bc","#5e97f5","#e06055","#f5bf26","#33ab71","#b762c6","#00acc1","#ff855f","#9e9d24","#26b8ca","#ff7043"];function _t(e){const r=window.getComputedStyle(e,null).getPropertyValue("font-size");return parseFloat(r)}function jt(e){return e.r*.299+e.g*.587+e.b*.114}function Yt(e){return jt(e)>165}function Tt(e){return Yt(c.color(e))?"black":"white"}function ft(e){const r=e.getFullYear(),d=String(e.getMonth()+1).padStart(2,"0"),p=String(e.getDate()).padStart(2,"0");return`${r}${d}${p}`}function X(e,r){return"translate("+e+","+r+")"}function Dt(){let e=St,r=5,d=2,p=!1,M=!1,v,H,E=0,S=K(0),i=K(1),a=K(2),u=K(3);function D(l,g){const f=l.select("text"),$=l.select("rect"),s=$.attr("width")-2*r,n=i(g);f.text(n);let t=f.node().getComputedTextLength();if(t>s){const m=s<0?0:s/t,x=Math.floor(n.length*m);f.text(x>2?n.slice(0,x-2)+"â€¦":"")}}function C(l,g,f){const $=l.select("text").node(),s=$.getBBox(),n=f.scale().domain().indexOf(S(g)),t=f.colorscale()(n),m=l.selectAll("rect.bckg").data([g]).join("rect").attr("class","bckg").attr("fill",t).attr("x",s.x-r+d).attr("y",s.y-2).attr("width",s.width+r-d).attr("height",s.height);l.node().insertBefore(m.node(),$)}function B(l,g){l.each(function(f,$){const s=c.select(this.parentNode);u(f)-a(f)?D(s,f):C(s,f,g)})}function P(l){return function(g,f){c.active(this).tween("text",function(){return function($){B(c.select(this),l)}})}}function y(l){const g=l.datum(),f=new Set(c.map(g,S)),$=new tt(_),s=c.scaleOrdinal(e);v=v||[c.min(g,a),c.max(g,u)],M&&(v=c.extent(v.concat(new Date))),l.each(function(n){const t=H||this.getBoundingClientRect().width,m=f.size*(_t(this)+4*r),x=c.scaleBand().domain(f).range([0,m]),h=c.scaleTime().domain(v),A=(p?at:it)(x).width(t),j=c.select(this).selectAll("svg").data([1]).join("svg");j.attr("class","timeline").attr("width",t).attr("height",m+40);const F=j.append("g").attr("transform","translate(0,20)"),R=F.append("g").attr("class","y axis").call(A);R.selectAll("text").attr("text-anchor",function(o){return o.startsWith(" â€¢")?"middle":"end"}).attr("x",function(o){return o.startsWith(" â€¢")?167:332.5}).style("cursor","pointer").style("font-weight",function(o){return o.startsWith(" â€¢")?"bold":"normal"}).style("background","none").on("click",function(o,w){const k=`https://www.primarysourcecoop.org/publications/jqa/search#q%3D%2Bsubject%3A%22${w.replace(/ â€¢ /g,"").replace(" ","%20")}%22`;window.open(k,"_blank")}),R.selectAll("g.row").each(function(o){const T=c.select(this).select("text").text();c.select(this).classed(c.select(this).select("text").text().replace(/â€¢/g,"").replace(/ /g,"-").replace(/[^a-zA-Z0-9-]/g,""),!0),T.startsWith(" â€¢")&&c.select(this).classed("timelineheader",!0).append("text").attr("x",320.5).attr("y",25).text("-").style("text-anchor","end").style("cursor","pointer").style("font-size","20px").attr("fill","black")});function nt(o,w){let b=o.getAttribute("transform").match(/translate\(([\d.-]+),([\d.-]+)\)/);if(b){let k=parseFloat(b[1]),Y=parseFloat(b[2]);Y+=w,o.setAttribute("transform",`translate(${k},${Y})`)}}function Q(o,w,T){const k=c.select(o).attr("class");let Y=!1;w.selectAll("g.row").each(function(q){const G=c.select(this).attr("class");G==k?Y=!0:Y&&(nt(this,T),Z(G.split(" ")[1],T))})}function Z(o,w){document.querySelectorAll(`g.task.${o} rect`).forEach(function(k){let q=parseFloat(k.getAttribute("y"))+w;k.setAttribute("y",q)}),document.querySelectorAll(`g.task.${o} text`).forEach(function(k){let q=parseFloat(k.getAttribute("y"))+w;k.setAttribute("y",q)})}function mt(o,w,T){const k=c.select(o).attr("class"),Y=[];let q=!1,W=!1;return w.selectAll("g.row").each(function(G){const J=c.select(this).attr("class");J==k?q=!0:q&&J.split(" ")[2]=="timelineheader"?W=!0:q&&!W&&Y.push(J.split(" ")[1])}),console.log(`Rows under ${k}:`,Y),Y.forEach(function(G){document.querySelectorAll(`.${G}`).forEach(function(J){J.style.display=T})}),Y.length*38}R.selectAll("g.row.timelineheader text").on("click",function(o,w){const T=c.select(this).text();if(T==="+"){let b=mt(this.parentNode,R,"block");Q(this.parentNode,R,b),pt(b),gt(b),c.select(this).text()==="+"?c.select(this).text("-"):c.select(this).text("+")}else if(T==="-"){let b=mt(this.parentNode,R,"none");Q(this.parentNode,R,-b),pt(-b),gt(-b),c.select(this).text()==="-"?c.select(this).text("+"):c.select(this).text("-")}});function pt(o){const w=document.querySelector('path[stroke-width="1.75"]');if(w){let b=w.getAttribute("d").match(/M([\d.-]+),([\d.-]+)V([\d.-]+)/);if(b){let k=parseFloat(b[1]),Y=parseFloat(b[2]),W=parseFloat(b[3])+o;w.setAttribute("d",`M${k},${Y}V${W}`)}}else console.error('Path with stroke-width="1.75" not found.')}function gt(o){const w=document.querySelector("g.x.axis.bottom-axis");if(w){let b=w.getAttribute("transform").match(/translate\(([\d.-]+),([\d.-]+)\)/);if(b){let k=parseFloat(b[1]),q=parseFloat(b[2])+o;w.setAttribute("transform",`translate(${k},${q})`)}}else console.error("x axis bottom-axis not found.")}let N=A.range();h.range([N[0]+r,N[1]-r]).clamp(!0);const rt=c.axisBottom(h),I=F.append("g").attr("class","x axis").attr("transform",X(0,0)).call(rt);I.selectAll(".tick text").attr("dy","-1.5em"),I.selectAll(".tick line").attr("y2","-5");const Ft=c.axisBottom(h);j.append("g").attr("class","x axis bottom-axis").attr("transform",X(0,m+20)).call(Ft).selectAll(".tick line").attr("y2","5"),R.on("offset",()=>{N=A.range(),h.range([N[0]+r,N[1]-r]).clamp(!0),rt.ticks(Math.min((N[1]-N[0])/70,10)),I.call(rt),V.attr("transform",o=>X(h(a(o)),x(S(o)))).selectAll("rect").attr("width",o=>h(u(o))-h(a(o))||d).call(o=>B(o,A)),R.call(A.draw_ticks,h.ticks().map(h))}),I.select(".domain").remove(),I.selectAll(".tick line").attr("stroke","#AAA");const Ot=h.ticks().map(h);R.call(A.draw_ticks,Ot);let V=F.selectAll("g.task").data(n);V.exit().remove();const st=V.enter().append("g").classed("task",!0);st.each(function(o){const w=S(o).replace(/â€¢/g,"").replace(/ /g,"-").replace(/[^a-zA-Z0-9-]/g,"");c.select(this).classed(w,!0)}).append("rect").style("opacity",.7).attr("y",r).style("cursor","pointer").attr("height",x.bandwidth()-2*r).on("mouseover",$.show).on("mouseout",$.hide).on("click",function(o,w){var T=String(w[1]),b=T.replace(" ","%20"),k=w[2],Y=ft(k),q=w[3],W=ft(q),G="https://www.primarysourcecoop.org/publications/jqa/search#q%3D%2Bsubject%3A%22"+b+"%22%20%2Bdate_when%3A%5B"+Y+"%20TO%20"+W+"%5D%7Crows=20%7Cstart=0%7Chl=true%7Chl.fl=text_merge%7Csort=date_when%20asc%7Cff=person_keyword;subject%7Cfl=id%20index%20title%20filename%20resource_group_name%20date_when%20date_to%20author%20recipient%20person_keyword%20subject%20doc_beginning";window.open(G,"_blank")}).style("fill",et(i,s)),st.append("text").attr("text-anchor","start").attr("fill",o=>u(o)-a(o)?et(i,s,Tt)(o):"black").attr("pointer-events","none").attr("dx",r).attr("y",x.bandwidth()/2).attr("dy","0.32em").text(i),V=V.merge(st),V.attr("transform",o=>X(N[0],x(S(o)))).selectAll("rect").attr("width",0),V.transition().duration(E).attr("transform",o=>X(h(a(o)),x(S(o)))).selectAll("rect").attr("width",o=>h(u(o))-h(a(o))||d).on("start",P(A)),M&&F.append("path").attr("stroke","red").attr("d","M"+h(new Date)+",0.5V"+m)})}return y.dates=function(l){return arguments.length?(v=l,y):v},y.width=function(l){return arguments.length?(H=l,y):H},y.today=function(l){return arguments.length?(M=l,y):M},y.colors=function(l){return arguments.length?(e=l,y):e},y.padding=function(l){return arguments.length?(r=l,y):r},y.milestone_width=function(l){return arguments.length?(d=l,y):d},y.reversed=function(l){return arguments.length?(p=l,y):p},y.duration=function(l){return arguments.length?(E=l,y):E},y;function _(l,g){const f=et(c.isoParse,c.timeFormat("%Y-%m-%d")),$=`<b>${i(g)}</b><hr style="margin: 2px 0 2px 0">${f(a(g))}`,s=u(g)-a(g)?` - ${f(u(g))}<br>${ht(a(g),u(g))}`:"";return $+s}}O.durationFormat=ht,O.timeline=Dt,O.timelineAxisLeft=it,O.timelineAxisRight=at,O.tooltip=tt,Object.keys(z).forEach(e=>{e!=="default"&&!Object.prototype.hasOwnProperty.call(O,e)&&Object.defineProperty(O,e,{enumerable:!0,get:()=>z[e]})}),Object.defineProperty(O,Symbol.toStringTag,{value:"Module"})});
