(function(j,E){typeof exports=="object"&&typeof module<"u"?E(exports,require("d3"),require("dayjs")):typeof define=="function"&&define.amd?define(["exports","d3","dayjs"],E):(j=typeof globalThis<"u"?globalThis:j||self,E(j.d3=j.d3||{},j.d3,j.dayjs))})(this,function(j,E,V){"use strict";function ot(e){const r=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const u in e)if(u!=="default"){const f=Object.getOwnPropertyDescriptor(e,u);Object.defineProperty(r,u,f.get?f:{enumerable:!0,get:()=>e[u]})}}return r.default=e,Object.freeze(r)}const y=ot(E),at="div.tooltip {        position: absolute;        text-align: center;        padding: 5px;        /* font: 12px sans-serif; */        background: white;        border: 1px solid #AAA;        border-radius: 2px;        pointer-events: none;      }";function R(e){y.select("head").selectAll("#tooltip").data([1]).enter().append("style").attr("id","tooltip").text(at);const r=y.select("body").append("div").attr("class","tooltip").style("opacity",0);return r.show=function(u){r.transition().duration(100).style("opacity",.95),r.html(e.apply(null,arguments)).style("left",u.pageX+"px").style("top",u.pageY-28+"px")},r.hide=function(u){r.transition().duration(100).style("opacity",0)},r}function ct(e){return y.max(e.nodes().map(r=>r.getComputedTextLength()))}function ut(e){return function(r){return r.length>e?r.slice(0,e-1)+"…":r}}const z=1,lt=2;function X(e,r){let u=["#FFF","#EEE"],f=y.scaleOrdinal(u),v=5,w,B="#AAA",O=40,k=3e3,i;function o(c){let S=r.domain(),D=R(s=>s),T=y.scaleOrdinal(u),Y=y.scaleOrdinal(u.reverse()),g=ut(O),M=c.selectAll(".row").data(S,r).order(),a=M.enter().append("g").attr("class","row"),m=M.exit(),d=M.select("text");M=M.merge(a).attr("transform",s=>"translate(0,"+r(s)+")"),m.remove(),a.append("rect").attr("y",.5).attr("width",k).attr("height",r.bandwidth()).attr("stroke",B).attr("stroke-width",.75).attr("fill",T),a.append("path").attr("stroke",Y),d=d.merge(a.append("text").attr("y",r.bandwidth()/2).attr("dy","0.32em").on("mouseover",function(s,n){y.select(this).text()!=n&&D.show(n)}).on("mouseout",D.hide)).text(g),i===void 0&&(i=ct(d)+2*v,i=e===z?k-i:i),w=e===z?[0,i]:[i,k],d.attr("text-anchor",e===z?"start":"end").attr("dx",e===z?v:-v).attr("x",i);const x=function(s,n){i=Math.max(10,Math.min(k-10,i+s.dx)),y.select(this).attr("d","M"+i+",0.5V"+r.range()[1]),d.attr("x",i),w=e===z?[0,i]:[i,k],c.dispatch("offset",{detail:{offset:i}})};c.selectAll("g.y.axis > path").data([1]).join("path").attr("stroke",B).attr("stroke-width",1.75).attr("d","M"+(i+.5)+",0.5V"+r.range()[1]).style("cursor","ew-resize").call(y.drag().on("drag",x))}return o.draw_ticks=function(c,S){c.selectAll(".row").select("path").attr("d",S.map(D=>"M"+D+",1v"+(r.bandwidth()-1)).join(""))},o.scale=function(c){return arguments.length?(r=c,o):r},o.width=function(c){return arguments.length?(k=c,o):k},o.colors=function(c){return arguments.length?(u=c,o):u},o.padding=function(c){return arguments.length?(v=c,o):v},o.range=function(c){return arguments.length?(w=c,o):w},o.trim=function(c){return arguments.length?(O=c,o):O},o.offset=function(c){return arguments.length?(i=c,o):i},o.colorscale=function(c){return arguments.length?(f=c,o):f},o}function Z(e){return X(lt,e)}function K(e){return X(z,e)}var Q=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function U(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var tt={exports:{}};(function(e,r){(function(u,f){e.exports=f()})(Q,function(){var u,f,v=1e3,w=6e4,B=36e5,O=864e5,k=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,i=31536e6,o=2628e6,c=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,S={years:i,months:o,days:O,hours:B,minutes:w,seconds:v,milliseconds:1,weeks:6048e5},D=function(s){return s instanceof d},T=function(s,n,t){return new d(s,t,n.$l)},Y=function(s){return f.p(s)+"s"},g=function(s){return s<0},M=function(s){return g(s)?Math.ceil(s):Math.floor(s)},a=function(s){return Math.abs(s)},m=function(s,n){return s?g(s)?{negative:!0,format:""+a(s)+n}:{negative:!1,format:""+s+n}:{negative:!1,format:""}},d=function(){function s(t,h,p){var l=this;if(this.$d={},this.$l=p,t===void 0&&(this.$ms=0,this.parseFromMilliseconds()),h)return T(t*S[Y(h)],this);if(typeof t=="number")return this.$ms=t,this.parseFromMilliseconds(),this;if(typeof t=="object")return Object.keys(t).forEach(function(A){l.$d[Y(A)]=t[A]}),this.calMilliseconds(),this;if(typeof t=="string"){var b=t.match(c);if(b){var _=b.slice(2).map(function(A){return A!=null?Number(A):0});return this.$d.years=_[0],this.$d.months=_[1],this.$d.weeks=_[2],this.$d.days=_[3],this.$d.hours=_[4],this.$d.minutes=_[5],this.$d.seconds=_[6],this.calMilliseconds(),this}}return this}var n=s.prototype;return n.calMilliseconds=function(){var t=this;this.$ms=Object.keys(this.$d).reduce(function(h,p){return h+(t.$d[p]||0)*S[p]},0)},n.parseFromMilliseconds=function(){var t=this.$ms;this.$d.years=M(t/i),t%=i,this.$d.months=M(t/o),t%=o,this.$d.days=M(t/O),t%=O,this.$d.hours=M(t/B),t%=B,this.$d.minutes=M(t/w),t%=w,this.$d.seconds=M(t/v),t%=v,this.$d.milliseconds=t},n.toISOString=function(){var t=m(this.$d.years,"Y"),h=m(this.$d.months,"M"),p=+this.$d.days||0;this.$d.weeks&&(p+=7*this.$d.weeks);var l=m(p,"D"),b=m(this.$d.hours,"H"),_=m(this.$d.minutes,"M"),A=this.$d.seconds||0;this.$d.milliseconds&&(A+=this.$d.milliseconds/1e3,A=Math.round(1e3*A)/1e3);var P=m(A,"S"),C=t.negative||h.negative||l.negative||b.negative||_.negative||P.negative,q=b.format||_.format||P.format?"T":"",F=(C?"-":"")+"P"+t.format+h.format+l.format+q+b.format+_.format+P.format;return F==="P"||F==="-P"?"P0D":F},n.toJSON=function(){return this.toISOString()},n.format=function(t){var h=t||"YYYY-MM-DDTHH:mm:ss",p={Y:this.$d.years,YY:f.s(this.$d.years,2,"0"),YYYY:f.s(this.$d.years,4,"0"),M:this.$d.months,MM:f.s(this.$d.months,2,"0"),D:this.$d.days,DD:f.s(this.$d.days,2,"0"),H:this.$d.hours,HH:f.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:f.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:f.s(this.$d.seconds,2,"0"),SSS:f.s(this.$d.milliseconds,3,"0")};return h.replace(k,function(l,b){return b||String(p[l])})},n.as=function(t){return this.$ms/S[Y(t)]},n.get=function(t){var h=this.$ms,p=Y(t);return p==="milliseconds"?h%=1e3:h=p==="weeks"?M(h/S[p]):this.$d[p],h||0},n.add=function(t,h,p){var l;return l=h?t*S[Y(h)]:D(t)?t.$ms:T(t,this).$ms,T(this.$ms+l*(p?-1:1),this)},n.subtract=function(t,h){return this.add(t,h,!0)},n.locale=function(t){var h=this.clone();return h.$l=t,h},n.clone=function(){return T(this.$ms,this)},n.humanize=function(t){return u().add(this.$ms,"ms").locale(this.$l).fromNow(!t)},n.valueOf=function(){return this.asMilliseconds()},n.milliseconds=function(){return this.get("milliseconds")},n.asMilliseconds=function(){return this.as("milliseconds")},n.seconds=function(){return this.get("seconds")},n.asSeconds=function(){return this.as("seconds")},n.minutes=function(){return this.get("minutes")},n.asMinutes=function(){return this.as("minutes")},n.hours=function(){return this.get("hours")},n.asHours=function(){return this.as("hours")},n.days=function(){return this.get("days")},n.asDays=function(){return this.as("days")},n.weeks=function(){return this.get("weeks")},n.asWeeks=function(){return this.as("weeks")},n.months=function(){return this.get("months")},n.asMonths=function(){return this.as("months")},n.years=function(){return this.get("years")},n.asYears=function(){return this.as("years")},s}(),x=function(s,n,t){return s.add(n.years()*t,"y").add(n.months()*t,"M").add(n.days()*t,"d").add(n.hours()*t,"h").add(n.minutes()*t,"m").add(n.seconds()*t,"s").add(n.milliseconds()*t,"ms")};return function(s,n,t){u=t,f=t().$utils(),t.duration=function(l,b){var _=t.locale();return T(l,{$l:_},b)},t.isDuration=D;var h=n.prototype.add,p=n.prototype.subtract;n.prototype.add=function(l,b){return D(l)?x(this,l,1):h.bind(this)(l,b)},n.prototype.subtract=function(l,b){return D(l)?x(this,l,-1):p.bind(this)(l,b)}}})})(tt);var dt=tt.exports;const ht=U(dt);var et={exports:{}};(function(e,r){(function(u,f){e.exports=f()})(Q,function(){return function(u,f,v){u=u||{};var w=f.prototype,B={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function O(i,o,c,S){return w.fromToBase(i,o,c,S)}v.en.relativeTime=B,w.fromToBase=function(i,o,c,S,D){for(var T,Y,g,M=c.$locale().relativeTime||B,a=u.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],m=a.length,d=0;d<m;d+=1){var x=a[d];x.d&&(T=S?v(i).diff(c,x.d,!0):c.diff(i,x.d,!0));var s=(u.rounding||Math.round)(Math.abs(T));if(g=T>0,s<=x.r||!x.r){s<=1&&d>0&&(x=a[d-1]);var n=M[x.l];D&&(s=D(""+s)),Y=typeof n=="string"?n.replace("%d",s):n(s,o,x.l,g);break}}if(o)return Y;var t=g?M.future:M.past;return typeof t=="function"?t(Y):t.replace("%s",Y)},w.to=function(i,o){return O(i,o,this,!0)},w.from=function(i,o){return O(i,o,this)};var k=function(i){return i.$u?v.utc():v()};w.toNow=function(i){return this.to(k(this),i)},w.fromNow=function(i){return this.from(k(this),i)}}})})(et);var ft=et.exports;const mt=U(ft);V.extend(ht),V.extend(mt);function nt(e,r){return V.duration(r-e).humanize()}function I(){const e=Array.prototype.slice.call(arguments,0);return function(r){return e.reduce((u,f)=>f(u),r)}}function L(e){return function(r){return e===void 0?r:r[e]}}const pt=["#4285f4","#db4437","#f4b400","#0f9d58","#ab47bc","#5e97f5","#e06055","#f5bf26","#33ab71","#b762c6","#00acc1","#ff855f","#9e9d24","#26b8ca","#ff7043"];function gt(e){const r=window.getComputedStyle(e,null).getPropertyValue("font-size");return parseFloat(r)}function yt(e){return e.r*.299+e.g*.587+e.b*.114}function xt(e){return yt(e)>165}function wt(e){return xt(y.color(e))?"black":"white"}function rt(e){const r=e.getFullYear(),u=String(e.getMonth()+1).padStart(2,"0"),f=String(e.getDate()).padStart(2,"0");return`${r}${u}${f}`}function N(e,r){return"translate("+e+","+r+")"}function bt(){let e=pt,r=5,u=2,f=!1,v=!1,w,B,O=0,k=L(0),i=L(1),o=L(2),c=L(3);function S(a,m){const d=a.select("text"),x=a.select("rect"),s=x.attr("width")-2*r,n=i(m);d.text(n);let t=d.node().getComputedTextLength();if(t>s){const h=s<0?0:s/t,p=Math.floor(n.length*h);d.text(p>2?n.slice(0,p-2)+"…":"")}}function D(a,m,d){const x=a.select("text").node(),s=x.getBBox(),n=d.scale().domain().indexOf(k(m)),t=d.colorscale()(n),h=a.selectAll("rect.bckg").data([m]).join("rect").attr("class","bckg").attr("fill",t).attr("x",s.x-r+u).attr("y",s.y-2).attr("width",s.width+r-u).attr("height",s.height);a.node().insertBefore(h.node(),x)}function T(a,m){a.each(function(d,x){const s=y.select(this.parentNode);c(d)-o(d)?S(s,d):D(s,d,m)})}function Y(a){return function(m,d){y.active(this).tween("text",function(){return function(x){T(y.select(this),a)}})}}function g(a){const m=a.datum(),d=new Set(y.map(m,k)),x=new R(M),s=y.scaleOrdinal(e);w=w||[y.min(m,o),y.max(m,c)],v&&(w=y.extent(w.concat(new Date))),a.each(function(n){const t=B||this.getBoundingClientRect().width,h=d.size*(gt(this)+4*r),p=y.scaleBand().domain(d).range([0,h]),l=y.scaleTime().domain(w),b=(f?K:Z)(p).width(t),_=y.select(this).selectAll("svg").data([1]).join("svg");_.attr("class","timeline").attr("width",t).attr("height",h+40);const A=_.append("g").attr("transform","translate(0,20)"),P=A.append("g").attr("class","y axis").call(b);P.selectAll("text").style("cursor","pointer").on("click",function($,G){const J=`https://www.primarysourcecoop.org/publications/jqa/search#q%3D%2Bsubject%3A%22${G.replace(/--/g,"").replace(" ","%20")}%22`;window.open(J,"_blank")});let C=b.range();l.range([C[0]+r,C[1]-r]).clamp(!0);const q=y.axisBottom(l),F=A.append("g").attr("class","x axis").attr("transform",N(0,0)).call(q);F.selectAll(".tick text").attr("dy","-1.5em"),F.selectAll(".tick line").attr("y2","-5");const $t=y.axisBottom(l);_.append("g").attr("class","x axis bottom-axis").attr("transform",N(0,h+20)).call($t).selectAll(".tick line").attr("y2","5"),P.on("offset",()=>{C=b.range(),l.range([C[0]+r,C[1]-r]).clamp(!0),q.ticks(Math.min((C[1]-C[0])/70,10)),F.call(q),H.attr("transform",$=>N(l(o($)),p(k($)))).selectAll("rect").attr("width",$=>l(c($))-l(o($))||u).call($=>T($,b)),P.call(b.draw_ticks,l.ticks().map(l))}),F.select(".domain").remove(),F.selectAll(".tick line").attr("stroke","#AAA");const vt=l.ticks().map(l);P.call(b.draw_ticks,vt);let H=A.selectAll("g.task").data(n);H.exit().remove();const W=H.enter().append("g").classed("task",!0);W.append("rect").attr("y",r).style("cursor","pointer").attr("height",p.bandwidth()-2*r).on("mouseover",x.show).on("mouseout",x.hide).on("click",function($,G){var st=String(G[1]),it=st.replace(" ","%20"),J=G[2],Mt=rt(J),kt=G[3],_t=rt(kt),St="https://www.primarysourcecoop.org/publications/jqa/search#q%3D%2Bsubject%3A%22"+it+"%22%20%2Bdate_when%3A%5B"+Mt+"%20TO%20"+_t+"%5D%7Crows=20%7Cstart=0%7Chl=true%7Chl.fl=text_merge%7Csort=date_when%20asc%7Cff=person_keyword;subject%7Cfl=id%20index%20title%20filename%20resource_group_name%20date_when%20date_to%20author%20recipient%20person_keyword%20subject%20doc_beginning";window.open(St,"_blank")}).style("fill",I(i,s)),W.append("text").attr("text-anchor","start").attr("fill",$=>c($)-o($)?I(i,s,wt)($):"black").attr("pointer-events","none").attr("dx",r).attr("y",p.bandwidth()/2).attr("dy","0.32em").text(i),H=H.merge(W),H.attr("transform",$=>N(C[0],p(k($)))).selectAll("rect").attr("width",0),H.transition().duration(O).attr("transform",$=>N(l(o($)),p(k($)))).selectAll("rect").attr("width",$=>l(c($))-l(o($))||u).on("start",Y(b)),v&&A.append("path").attr("stroke","red").attr("d","M"+l(new Date)+",0.5V"+h)})}return g.dates=function(a){return arguments.length?(w=a,g):w},g.width=function(a){return arguments.length?(B=a,g):B},g.today=function(a){return arguments.length?(v=a,g):v},g.colors=function(a){return arguments.length?(e=a,g):e},g.padding=function(a){return arguments.length?(r=a,g):r},g.milestone_width=function(a){return arguments.length?(u=a,g):u},g.reversed=function(a){return arguments.length?(f=a,g):f},g.duration=function(a){return arguments.length?(O=a,g):O},g;function M(a,m){const d=I(y.isoParse,y.timeFormat("%Y-%m-%d")),x=`<b>${i(m)}</b><hr style="margin: 2px 0 2px 0">${d(o(m))}`,s=c(m)-o(m)?` - ${d(c(m))}<br>${nt(o(m),c(m))}`:"";return x+s}}j.durationFormat=nt,j.timeline=bt,j.timelineAxisLeft=Z,j.timelineAxisRight=K,j.tooltip=R,Object.keys(E).forEach(e=>{e!=="default"&&!Object.prototype.hasOwnProperty.call(j,e)&&Object.defineProperty(j,e,{enumerable:!0,get:()=>E[e]})}),Object.defineProperty(j,Symbol.toStringTag,{value:"Module"})});
