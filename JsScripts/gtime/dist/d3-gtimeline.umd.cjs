(function(N,H){typeof exports=="object"&&typeof module<"u"?H(exports,require("d3"),require("dayjs")):typeof define=="function"&&define.amd?define(["exports","d3","dayjs"],H):(N=typeof globalThis<"u"?globalThis:N||self,H(N.d3=N.d3||{},N.d3,N.dayjs))})(this,function(N,H,j){"use strict";function Tt(t){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const n in t)if(n!=="default"){const r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:()=>t[n]})}}return e.default=t,Object.freeze(e)}const d=Tt(H),Bt="div.tooltip {        position: absolute;        text-align: center;        padding: 5px;        /* font: 12px sans-serif; */        background: white;        border: 1px solid #AAA;        border-radius: 2px;        pointer-events: none;      }";function tt(t){d.select("head").selectAll("#tooltip").data([1]).enter().append("style").attr("id","tooltip").text(Bt);const e=d.select("body").append("div").attr("class","tooltip").style("opacity",0);return e.show=function(n){e.transition().duration(100).style("opacity",.95),e.html(t.apply(null,arguments)).style("left",n.pageX+"px").style("top",n.pageY-28+"px")},e.hide=function(n){e.transition().duration(100).style("opacity",0)},e}function Ot(t){return d.max(t.nodes().map(e=>e.getComputedTextLength()))}function Yt(t){return function(e){return e.length>t?e.slice(0,t-1)+"…":e}}const V=1,Pt=2;function at(t,e){let n=["#FFF","#FFF"],r=d.scaleOrdinal(n),s=5,i,o="#AAA",l=40,c=3e3,a;function f(p){let x=e.domain(),b=tt(y=>y),S=d.scaleOrdinal(n),C=d.scaleOrdinal(n.reverse()),D=Yt(l),_=p.selectAll(".row").data(x,e).order(),F=_.enter().append("g").attr("class","row"),g=_.exit(),w=_.select("text");_=_.merge(F).attr("transform",y=>"translate(0,"+e(y)+")"),g.remove(),F.append("rect").attr("y",.5).attr("width",c).attr("height",e.bandwidth()).attr("stroke",o).attr("stroke-width",.75).attr("fill",S),F.append("path").attr("stroke",C),w=w.merge(F.append("text").attr("y",e.bandwidth()/2).attr("dy","0.32em").on("mouseover",function(y,m){d.select(this).text()!=m&&b.show(m)}).on("mouseout",b.hide)).text(D),a===void 0&&(a=Ot(w)+2*s,a=t===V?c-a:a),i=t===V?[0,a]:[a,c],w.attr("text-anchor",t===V?"start":"end").attr("dx",t===V?s:-s).attr("x",a),p.selectAll("g.y.axis > path").data([1]).join("path").attr("stroke",o).attr("stroke-width",1.75).attr("d","M"+(a+.5)+",0.5V"+e.range()[1])}return f.draw_ticks=function(p,x){p.selectAll(".row").select("path").attr("d",x.map(b=>"M"+b+",1v"+(e.bandwidth()-1)).join(""))},f.scale=function(p){return arguments.length?(e=p,f):e},f.width=function(p){return arguments.length?(c=p,f):c},f.colors=function(p){return arguments.length?(n=p,f):n},f.padding=function(p){return arguments.length?(s=p,f):s},f.range=function(p){return arguments.length?(i=p,f):i},f.trim=function(p){return arguments.length?(l=p,f):l},f.offset=function(p){return arguments.length?(a=p,f):a},f.colorscale=function(p){return arguments.length?(r=p,f):r},f}function lt(t){return at(Pt,t)}function ct(t){return at(V,t)}var ut=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ft(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ht={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(ut,function(){var n,r,s=1e3,i=6e4,o=36e5,l=864e5,c=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,a=31536e6,f=2628e6,p=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,x={years:a,months:f,days:l,hours:o,minutes:i,seconds:s,milliseconds:1,weeks:6048e5},b=function(m){return m instanceof w},S=function(m,h,u){return new w(m,u,h.$l)},C=function(m){return r.p(m)+"s"},D=function(m){return m<0},_=function(m){return D(m)?Math.ceil(m):Math.floor(m)},F=function(m){return Math.abs(m)},g=function(m,h){return m?D(m)?{negative:!0,format:""+F(m)+h}:{negative:!1,format:""+m+h}:{negative:!1,format:""}},w=function(){function m(u,A,M){var v=this;if(this.$d={},this.$l=M,u===void 0&&(this.$ms=0,this.parseFromMilliseconds()),A)return S(u*x[C(A)],this);if(typeof u=="number")return this.$ms=u,this.parseFromMilliseconds(),this;if(typeof u=="object")return Object.keys(u).forEach(function(T){v.$d[C(T)]=u[T]}),this.calMilliseconds(),this;if(typeof u=="string"){var k=u.match(p);if(k){var E=k.slice(2).map(function(T){return T!=null?Number(T):0});return this.$d.years=E[0],this.$d.months=E[1],this.$d.weeks=E[2],this.$d.days=E[3],this.$d.hours=E[4],this.$d.minutes=E[5],this.$d.seconds=E[6],this.calMilliseconds(),this}}return this}var h=m.prototype;return h.calMilliseconds=function(){var u=this;this.$ms=Object.keys(this.$d).reduce(function(A,M){return A+(u.$d[M]||0)*x[M]},0)},h.parseFromMilliseconds=function(){var u=this.$ms;this.$d.years=_(u/a),u%=a,this.$d.months=_(u/f),u%=f,this.$d.days=_(u/l),u%=l,this.$d.hours=_(u/o),u%=o,this.$d.minutes=_(u/i),u%=i,this.$d.seconds=_(u/s),u%=s,this.$d.milliseconds=u},h.toISOString=function(){var u=g(this.$d.years,"Y"),A=g(this.$d.months,"M"),M=+this.$d.days||0;this.$d.weeks&&(M+=7*this.$d.weeks);var v=g(M,"D"),k=g(this.$d.hours,"H"),E=g(this.$d.minutes,"M"),T=this.$d.seconds||0;this.$d.milliseconds&&(T+=this.$d.milliseconds/1e3,T=Math.round(1e3*T)/1e3);var q=g(T,"S"),O=u.negative||A.negative||v.negative||k.negative||E.negative||q.negative,Dt=k.format||E.format||q.format?"T":"",Q=(O?"-":"")+"P"+u.format+A.format+v.format+Dt+k.format+E.format+q.format;return Q==="P"||Q==="-P"?"P0D":Q},h.toJSON=function(){return this.toISOString()},h.format=function(u){var A=u||"YYYY-MM-DDTHH:mm:ss",M={Y:this.$d.years,YY:r.s(this.$d.years,2,"0"),YYYY:r.s(this.$d.years,4,"0"),M:this.$d.months,MM:r.s(this.$d.months,2,"0"),D:this.$d.days,DD:r.s(this.$d.days,2,"0"),H:this.$d.hours,HH:r.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:r.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:r.s(this.$d.seconds,2,"0"),SSS:r.s(this.$d.milliseconds,3,"0")};return A.replace(c,function(v,k){return k||String(M[v])})},h.as=function(u){return this.$ms/x[C(u)]},h.get=function(u){var A=this.$ms,M=C(u);return M==="milliseconds"?A%=1e3:A=M==="weeks"?_(A/x[M]):this.$d[M],A||0},h.add=function(u,A,M){var v;return v=A?u*x[C(A)]:b(u)?u.$ms:S(u,this).$ms,S(this.$ms+v*(M?-1:1),this)},h.subtract=function(u,A){return this.add(u,A,!0)},h.locale=function(u){var A=this.clone();return A.$l=u,A},h.clone=function(){return S(this.$ms,this)},h.humanize=function(u){return n().add(this.$ms,"ms").locale(this.$l).fromNow(!u)},h.valueOf=function(){return this.asMilliseconds()},h.milliseconds=function(){return this.get("milliseconds")},h.asMilliseconds=function(){return this.as("milliseconds")},h.seconds=function(){return this.get("seconds")},h.asSeconds=function(){return this.as("seconds")},h.minutes=function(){return this.get("minutes")},h.asMinutes=function(){return this.as("minutes")},h.hours=function(){return this.get("hours")},h.asHours=function(){return this.as("hours")},h.days=function(){return this.get("days")},h.asDays=function(){return this.as("days")},h.weeks=function(){return this.get("weeks")},h.asWeeks=function(){return this.as("weeks")},h.months=function(){return this.get("months")},h.asMonths=function(){return this.as("months")},h.years=function(){return this.get("years")},h.asYears=function(){return this.as("years")},m}(),y=function(m,h,u){return m.add(h.years()*u,"y").add(h.months()*u,"M").add(h.days()*u,"d").add(h.hours()*u,"h").add(h.minutes()*u,"m").add(h.seconds()*u,"s").add(h.milliseconds()*u,"ms")};return function(m,h,u){n=u,r=u().$utils(),u.duration=function(v,k){var E=u.locale();return S(v,{$l:E},k)},u.isDuration=b;var A=h.prototype.add,M=h.prototype.subtract;h.prototype.add=function(v,k){return b(v)?y(this,v,1):A.bind(this)(v,k)},h.prototype.subtract=function(v,k){return b(v)?y(this,v,-1):M.bind(this)(v,k)}}})})(ht);var Rt=ht.exports;const qt=ft(Rt);var dt={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(ut,function(){return function(n,r,s){n=n||{};var i=r.prototype,o={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function l(a,f,p,x){return i.fromToBase(a,f,p,x)}s.en.relativeTime=o,i.fromToBase=function(a,f,p,x,b){for(var S,C,D,_=p.$locale().relativeTime||o,F=n.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],g=F.length,w=0;w<g;w+=1){var y=F[w];y.d&&(S=x?s(a).diff(p,y.d,!0):p.diff(a,y.d,!0));var m=(n.rounding||Math.round)(Math.abs(S));if(D=S>0,m<=y.r||!y.r){m<=1&&w>0&&(y=F[w-1]);var h=_[y.l];b&&(m=b(""+m)),C=typeof h=="string"?h.replace("%d",m):h(m,f,y.l,D);break}}if(f)return C;var u=D?_.future:_.past;return typeof u=="function"?u(C):u.replace("%s",C)},i.to=function(a,f){return l(a,f,this,!0)},i.from=function(a,f){return l(a,f,this)};var c=function(a){return a.$u?s.utc():s()};i.toNow=function(a){return this.to(c(this),a)},i.fromNow=function(a){return this.from(c(this),a)}}})})(dt);var zt=dt.exports;const Ht=ft(zt);j.extend(qt),j.extend(Ht);function pt(t,e){return j.duration(e-t).humanize()}function et(){const t=Array.prototype.slice.call(arguments,0);return function(e){return t.reduce((n,r)=>r(n),e)}}function Z(t){return function(e){return t===void 0?e:e[t]}}var nt="http://www.w3.org/1999/xhtml";const mt={svg:"http://www.w3.org/2000/svg",xhtml:nt,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function gt(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),mt.hasOwnProperty(e)?{space:mt[e],local:t}:t}function Lt(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===nt&&e.documentElement.namespaceURI===nt?e.createElement(t):e.createElementNS(n,t)}}function Vt(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function yt(t){var e=gt(t);return(e.local?Vt:Lt)(e)}function It(){}function _t(t){return t==null?It:function(){return this.querySelector(t)}}function Wt(t){typeof t!="function"&&(t=_t(t));for(var e=this._groups,n=e.length,r=new Array(n),s=0;s<n;++s)for(var i=e[s],o=i.length,l=r[s]=new Array(o),c,a,f=0;f<o;++f)(c=i[f])&&(a=t.call(c,c.__data__,f,i))&&("__data__"in c&&(a.__data__=c.__data__),l[f]=a);return new B(r,this._parents)}function wt(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Xt(){return[]}function Ut(t){return t==null?Xt:function(){return this.querySelectorAll(t)}}function Zt(t){return function(){return wt(t.apply(this,arguments))}}function Gt(t){typeof t=="function"?t=Zt(t):t=Ut(t);for(var e=this._groups,n=e.length,r=[],s=[],i=0;i<n;++i)for(var o=e[i],l=o.length,c,a=0;a<l;++a)(c=o[a])&&(r.push(t.call(c,c.__data__,a,o)),s.push(c));return new B(r,s)}function Kt(t){return function(){return this.matches(t)}}function xt(t){return function(e){return e.matches(t)}}var Jt=Array.prototype.find;function Qt(t){return function(){return Jt.call(this.children,t)}}function jt(){return this.firstElementChild}function te(t){return this.select(t==null?jt:Qt(typeof t=="function"?t:xt(t)))}var ee=Array.prototype.filter;function ne(){return Array.from(this.children)}function re(t){return function(){return ee.call(this.children,t)}}function se(t){return this.selectAll(t==null?ne:re(typeof t=="function"?t:xt(t)))}function ie(t){typeof t!="function"&&(t=Kt(t));for(var e=this._groups,n=e.length,r=new Array(n),s=0;s<n;++s)for(var i=e[s],o=i.length,l=r[s]=[],c,a=0;a<o;++a)(c=i[a])&&t.call(c,c.__data__,a,i)&&l.push(c);return new B(r,this._parents)}function vt(t){return new Array(t.length)}function oe(){return new B(this._enter||this._groups.map(vt),this._parents)}function G(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}G.prototype={constructor:G,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function ae(t){return function(){return t}}function le(t,e,n,r,s,i){for(var o=0,l,c=e.length,a=i.length;o<a;++o)(l=e[o])?(l.__data__=i[o],r[o]=l):n[o]=new G(t,i[o]);for(;o<c;++o)(l=e[o])&&(s[o]=l)}function ce(t,e,n,r,s,i,o){var l,c,a=new Map,f=e.length,p=i.length,x=new Array(f),b;for(l=0;l<f;++l)(c=e[l])&&(x[l]=b=o.call(c,c.__data__,l,e)+"",a.has(b)?s[l]=c:a.set(b,c));for(l=0;l<p;++l)b=o.call(t,i[l],l,i)+"",(c=a.get(b))?(r[l]=c,c.__data__=i[l],a.delete(b)):n[l]=new G(t,i[l]);for(l=0;l<f;++l)(c=e[l])&&a.get(x[l])===c&&(s[l]=c)}function ue(t){return t.__data__}function fe(t,e){if(!arguments.length)return Array.from(this,ue);var n=e?ce:le,r=this._parents,s=this._groups;typeof t!="function"&&(t=ae(t));for(var i=s.length,o=new Array(i),l=new Array(i),c=new Array(i),a=0;a<i;++a){var f=r[a],p=s[a],x=p.length,b=he(t.call(f,f&&f.__data__,a,r)),S=b.length,C=l[a]=new Array(S),D=o[a]=new Array(S),_=c[a]=new Array(x);n(f,p,C,D,_,b,e);for(var F=0,g=0,w,y;F<S;++F)if(w=C[F]){for(F>=g&&(g=F+1);!(y=D[g])&&++g<S;);w._next=y||null}}return o=new B(o,r),o._enter=l,o._exit=c,o}function he(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function de(){return new B(this._exit||this._groups.map(vt),this._parents)}function pe(t,e,n){var r=this.enter(),s=this,i=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(s=e(s),s&&(s=s.selection())),n==null?i.remove():n(i),r&&s?r.merge(s).order():s}function me(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,s=n.length,i=r.length,o=Math.min(s,i),l=new Array(s),c=0;c<o;++c)for(var a=n[c],f=r[c],p=a.length,x=l[c]=new Array(p),b,S=0;S<p;++S)(b=a[S]||f[S])&&(x[S]=b);for(;c<s;++c)l[c]=n[c];return new B(l,this._parents)}function ge(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],s=r.length-1,i=r[s],o;--s>=0;)(o=r[s])&&(i&&o.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(o,i),i=o);return this}function ye(t){t||(t=_e);function e(p,x){return p&&x?t(p.__data__,x.__data__):!p-!x}for(var n=this._groups,r=n.length,s=new Array(r),i=0;i<r;++i){for(var o=n[i],l=o.length,c=s[i]=new Array(l),a,f=0;f<l;++f)(a=o[f])&&(c[f]=a);c.sort(e)}return new B(s,this._parents).order()}function _e(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function we(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function xe(){return Array.from(this)}function ve(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],s=0,i=r.length;s<i;++s){var o=r[s];if(o)return o}return null}function Ae(){let t=0;for(const e of this)++t;return t}function be(){return!this.node()}function $e(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var s=e[n],i=0,o=s.length,l;i<o;++i)(l=s[i])&&t.call(l,l.__data__,i,s);return this}function ke(t){return function(){this.removeAttribute(t)}}function Se(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Me(t,e){return function(){this.setAttribute(t,e)}}function Ee(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Ce(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function Fe(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Ne(t,e){var n=gt(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?Se:ke:typeof e=="function"?n.local?Fe:Ce:n.local?Ee:Me)(n,e))}function At(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function De(t){return function(){this.style.removeProperty(t)}}function Te(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Be(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function Oe(t,e,n){return arguments.length>1?this.each((e==null?De:typeof e=="function"?Be:Te)(t,e,n??"")):Ye(this.node(),t)}function Ye(t,e){return t.style.getPropertyValue(e)||At(t).getComputedStyle(t,null).getPropertyValue(e)}function Pe(t){return function(){delete this[t]}}function Re(t,e){return function(){this[t]=e}}function qe(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function ze(t,e){return arguments.length>1?this.each((e==null?Pe:typeof e=="function"?qe:Re)(t,e)):this.node()[t]}function bt(t){return t.trim().split(/^|\s+/)}function rt(t){return t.classList||new $t(t)}function $t(t){this._node=t,this._names=bt(t.getAttribute("class")||"")}$t.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function kt(t,e){for(var n=rt(t),r=-1,s=e.length;++r<s;)n.add(e[r])}function St(t,e){for(var n=rt(t),r=-1,s=e.length;++r<s;)n.remove(e[r])}function He(t){return function(){kt(this,t)}}function Le(t){return function(){St(this,t)}}function Ve(t,e){return function(){(e.apply(this,arguments)?kt:St)(this,t)}}function Ie(t,e){var n=bt(t+"");if(arguments.length<2){for(var r=rt(this.node()),s=-1,i=n.length;++s<i;)if(!r.contains(n[s]))return!1;return!0}return this.each((typeof e=="function"?Ve:e?He:Le)(n,e))}function We(){this.textContent=""}function Xe(t){return function(){this.textContent=t}}function Ue(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Ze(t){return arguments.length?this.each(t==null?We:(typeof t=="function"?Ue:Xe)(t)):this.node().textContent}function Ge(){this.innerHTML=""}function Ke(t){return function(){this.innerHTML=t}}function Je(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Qe(t){return arguments.length?this.each(t==null?Ge:(typeof t=="function"?Je:Ke)(t)):this.node().innerHTML}function je(){this.nextSibling&&this.parentNode.appendChild(this)}function tn(){return this.each(je)}function en(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function nn(){return this.each(en)}function rn(t){var e=typeof t=="function"?t:yt(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function sn(){return null}function on(t,e){var n=typeof t=="function"?t:yt(t),r=e==null?sn:typeof e=="function"?e:_t(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function an(){var t=this.parentNode;t&&t.removeChild(this)}function ln(){return this.each(an)}function cn(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function un(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function fn(t){return this.select(t?un:cn)}function hn(t){return arguments.length?this.property("__data__",t):this.node().__data__}function dn(t){return function(e){t.call(this,e,this.__data__)}}function pn(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function mn(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,s=e.length,i;n<s;++n)i=e[n],(!t.type||i.type===t.type)&&i.name===t.name?this.removeEventListener(i.type,i.listener,i.options):e[++r]=i;++r?e.length=r:delete this.__on}}}function gn(t,e,n){return function(){var r=this.__on,s,i=dn(e);if(r){for(var o=0,l=r.length;o<l;++o)if((s=r[o]).type===t.type&&s.name===t.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=i,s.options=n),s.value=e;return}}this.addEventListener(t.type,i,n),s={type:t.type,name:t.name,value:e,listener:i,options:n},r?r.push(s):this.__on=[s]}}function yn(t,e,n){var r=pn(t+""),s,i=r.length,o;if(arguments.length<2){var l=this.node().__on;if(l){for(var c=0,a=l.length,f;c<a;++c)for(s=0,f=l[c];s<i;++s)if((o=r[s]).type===f.type&&o.name===f.name)return f.value}return}for(l=e?gn:mn,s=0;s<i;++s)this.each(l(r[s],e,n));return this}function Mt(t,e,n){var r=At(t),s=r.CustomEvent;typeof s=="function"?s=new s(e,n):(s=r.document.createEvent("Event"),n?(s.initEvent(e,n.bubbles,n.cancelable),s.detail=n.detail):s.initEvent(e,!1,!1)),t.dispatchEvent(s)}function _n(t,e){return function(){return Mt(this,t,e)}}function wn(t,e){return function(){return Mt(this,t,e.apply(this,arguments))}}function xn(t,e){return this.each((typeof e=="function"?wn:_n)(t,e))}function*vn(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],s=0,i=r.length,o;s<i;++s)(o=r[s])&&(yield o)}var An=[null];function B(t,e){this._groups=t,this._parents=e}function bn(){return this}B.prototype={constructor:B,select:Wt,selectAll:Gt,selectChild:te,selectChildren:se,filter:ie,data:fe,enter:oe,exit:de,join:pe,merge:me,selection:bn,order:ge,sort:ye,call:we,nodes:xe,node:ve,size:Ae,empty:be,each:$e,attr:Ne,style:Oe,property:ze,classed:Ie,text:Ze,html:Qe,raise:tn,lower:nn,append:rn,insert:on,remove:ln,clone:fn,datum:hn,on:yn,dispatch:xn,[Symbol.iterator]:vn};function Et(t){return typeof t=="string"?new B([document.querySelectorAll(t)],[document.documentElement]):new B([wt(t)],An)}const $n=["#4285f4","#db4437","#f4b400","#0f9d58","#ab47bc","#5e97f5","#e06055","#f5bf26","#33ab71","#b762c6","#00acc1","#ff855f","#9e9d24","#26b8ca","#ff7043"];function kn(t){const e=window.getComputedStyle(t,null).getPropertyValue("font-size");return parseFloat(e)}function Sn(t){return t.r*.299+t.g*.587+t.b*.114}function Mn(t){return Sn(t)>165}function En(t){return Mn(d.color(t))?"black":"white"}function Ct(t){const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}${n}${r}`}function I(t,e){return"translate("+t+","+e+")"}function Cn(){document.querySelectorAll('g.task[class*=" --"]').forEach(function(e){e.style.display="none"})}function K(t,e,n){const s=d.select(t).attr("class");let i=!1;e.selectAll("g.row").each(function(F){const w=d.select(this).attr("class");if(w==s)i=!0;else if(i){let m=this.getAttribute("transform"),h=parseFloat(m.split("(")[1].split(",")[0].trim()),u=parseFloat(m.split(",")[1].split(")")[0].trim());this.setAttribute("transform",`translate(${h},${u+n})`);var y=w.split(" ")[1];document.querySelectorAll(`g.task.${y} rect`).forEach(function(v){v.setAttribute("y",parseFloat(v.getAttribute("y"))+n)}),document.querySelectorAll(`g.task.${y} text`).forEach(function(v){v.setAttribute("y",parseFloat(v.getAttribute("y"))+n)})}});const o=document.querySelector('path[stroke-width="1.75"]');let c=o.getAttribute("d").match(/M([\d.-]+),([\d.-]+)V([\d.-]+)/),a=parseFloat(c[1]),f=parseFloat(c[2]),x=parseFloat(c[3])+n;o.setAttribute("d",`M${a},${f}V${x}`);const b=d.select("g.x.axis.bottom-axis");let S=b.attr("transform"),C=parseFloat(S.split("(")[1].split(",")[0].trim()),_=parseFloat(S.split(",")[1].split(")")[0].trim())+n;b.attr("transform",`translate(${C}, ${_})`)}function Ft(t,e){e.forEach(function(r){document.querySelectorAll(`g.row.${r}`).forEach(function(i){i.style.display="block"})});const n=d.select(t).attr("class").split(" ")[1];d.selectAll(`g.task.${n}`).each(function(r){var s=r[1].replace(/ /g,"-").replace(/[^a-zA-Z0-9-]/g,"");if(s==n.replace(/--/g,""))d.select(this).style("display","none");else if(s!=n.replace(/--/g,"")){d.select(this).style("display","block");var i=(e.indexOf(s)+1)*38;let o=d.select(this),l=o.attr("transform"),c=parseFloat(l.split("(")[1].split(",")[0].trim()),a=parseFloat(l.split(",")[1].split(")")[0].trim()),f=a+i;o.attr("transform",`translate(${c}, ${a})`).transition().duration(1e3).attr("transform",`translate(${c}, ${f})`).on("start",()=>{Et(`g.task.${s}`).style("display","none")}).on("end",()=>{o.style("display","none"),o.attr("transform",`translate(${c}, ${a})`),Et(`g.task.${s}`).style("display","block")})}})}function Nt(t,e){return new Promise(n=>{const r=d.select(t).attr("class").split(" ")[1];d.selectAll(`g.task:not(.${r})`).each(function(s){var i=s[1].replace(/ /g,"-").replace(/[^a-zA-Z0-9-]/g,"");if(e.includes(i)){d.select(this).style("display","block");var o=(e.indexOf(i)+1)*38;let l=d.select(this),c=l.attr("transform"),a=parseFloat(c.split("(")[1].split(",")[0].trim()),f=parseFloat(c.split(",")[1].split(")")[0].trim()),p=f-o;l.transition().duration(1e3).attr("transform",`translate(${a}, ${p})`).on("end",()=>{d.selectAll(`g.${r}`).style("display","block"),l.style("display","none"),l.attr("transform",`translate(${a}, ${f})`),e.forEach(function(x){document.querySelectorAll(`.${x}`).forEach(function(S){S.style.display="none"})}),n()})}})})}function J(t,e){const r=d.select(t).attr("class"),s=[];let i=!1,o=!1;return e.selectAll("g.row").each(function(l){const a=d.select(this).attr("class");a==r?i=!0:i&&a.split(" ")[2]=="timelineheader"?o=!0:i&&!o&&s.push(a.split(" ")[1])}),s}function Fn(){const t=document.getElementById("collapseAllButton");t.disabled=!0;let e=[];d.selectAll("g.row.timelineheader text").each(function(){if(d.select(this).text()==="-"){const r=this.parentNode,s=J(r,d.select(r.parentNode)),i=s.length*38;let o=Nt(r,s).then(()=>{K(r,d.select(r.parentNode),-i),d.select(this).text("+").style("font-size","20px")});e.push(o)}}),Promise.all(e).then(()=>{t.disabled=!1})}window.collapseAll=Fn;function Nn(){const t=document.getElementById("expandAllButton");t.disabled=!0;let e=[];d.selectAll("g.row.timelineheader text").each(function(){if(d.select(this).text()==="+"){const r=this.parentNode,s=J(r,d.select(r.parentNode)),i=s.length*38;let o=new Promise(l=>{Ft(r,s),K(r,d.select(r.parentNode),i),l()}).then(()=>{d.select(this).text("-").style("font-size","30px")});e.push(o)}}),Promise.all(e).then(()=>{t.disabled=!1})}window.expandAll=Nn;function Dn(t){let e=$n,n=5,r=2,s=!1,i=!1,o,l,c=0,a=Z(0),f=Z(1),p=Z(2),x=Z(3);console.log(t);function b(g,w){const y=g.select("text"),m=g.select("rect"),h=m.attr("width")-2*n,u=f(w);y.text(u);let A=y.node().getComputedTextLength();if(A>h){const M=h<0?0:h/A,v=Math.floor(u.length*M);y.text(v>2?u.slice(0,v-2)+"…":"")}}function S(g,w,y){const m=g.select("text").node(),h=m.getBBox(),u=y.scale().domain().indexOf(a(w)),A=y.colorscale()(u),M=g.selectAll("rect.bckg").data([w]).join("rect").attr("class","bckg").attr("fill",A).attr("x",h.x-n+r).attr("y",h.y-2).attr("width",h.width+n-r).attr("height",h.height);g.node().insertBefore(M.node(),m)}function C(g,w){g.each(function(y,m){const h=d.select(this.parentNode);x(y)-p(y)?b(h,y):S(h,y,w)})}function D(g){return function(w,y){d.active(this).tween("text",function(){return function(m){C(d.select(this),g)}})}}function _(g){const w=g.datum(),y=new Set(d.map(w,a)),m=new tt(F),h=d.scaleOrdinal(e);o=o||[d.min(w,p),d.max(w,x)],i&&(o=d.extent(o.concat(new Date))),g.each(function(u){const A=l||this.getBoundingClientRect().width,M=y.size*(kn(this)+4*n),v=d.scaleBand().domain(y).range([0,M]),k=d.scaleTime().domain(o),E=(s?ct:lt)(v).width(A),T=d.select(this).selectAll("svg").data([1]).join("svg");T.attr("class","timeline").attr("width",A).attr("height",M+40);const q=T.append("g").attr("transform","translate(0,20)"),O=q.append("g").attr("class","y axis").call(E);let Tn=document.querySelector('path[stroke-width="1.75"]').getAttribute("d").match(/M([\d.-]+),([\d.-]+)V([\d.-]+)/),st=parseFloat(Tn[1]);O.selectAll("text").on("mouseover",function(){d.select(this).style("text-decoration","underline")}).on("mouseout",function(){d.select(this).style("text-decoration","none")}).attr("text-anchor",function($){return $.startsWith(" •")?"middle":"end"}).attr("x",function($){return $.startsWith(" •")?st/2:st-.5}).style("cursor","pointer").style("font-weight",function($){return $.startsWith(" •")?"bold":"normal"}).style("background","none").on("click",function($,Y){const P=Y.replace(/ • /g,"").replace(" ","%20"),R=`https://www.primarysourcecoop.org/publications/${t}/search#q%3D%2Bsubject%3A%22${P}%22`;window.open(R,"_blank")}),O.selectAll("g.row").each(function($){const Y=d.select(this).datum();d.select(this).classed(d.select(this).datum().replace(/•/g,"").replace(/ /g,"-").replace(/[^a-zA-Z0-9-]/g,""),!0),Y.startsWith(" •")&&d.select(this).classed("timelineheader",!0).append("text").attr("x",st-10).attr("y",25).text("-").style("text-anchor","end").style("cursor","pointer").style("font-size","30px").attr("fill","black").style("-ms-user-select","none").style("-webkit-user-select","none").style("user-select","none")}),O.selectAll("g.row.timelineheader text").on("click",function($,Y){const X=d.select(this).text();if(X==="+"){let P=J(this.parentNode,O),R=P.length*38;Ft(this.parentNode,P),K(this.parentNode,O,R),d.select(this).text()==="+"?d.select(this).text("-").style("font-size","30px"):d.select(this).text("+")}else if(X==="-"){let P=J(this.parentNode,O),R=P.length*38;Nt(this.parentNode,P).then(()=>{K(this.parentNode,O,-R)}),d.select(this).text()==="-"?d.select(this).text("+").style("font-size","20px"):d.select(this).text("-")}else{const R=Y.replace(/ • /g,"").replace(" ","%20"),U=`https://www.primarysourcecoop.org/publications/${t}/search#q%3D%2Bsubject%3A%22${R}%22`;window.open(U,"_blank")}});let z=E.range();k.range([z[0]+n,z[1]-n]).clamp(!0);const it=d.axisBottom(k),W=q.append("g").attr("class","x axis").attr("transform",I(0,0)).call(it);W.selectAll(".tick text").attr("dy","-1.5em"),W.selectAll(".tick line").attr("y2","-5");const Bn=d.axisBottom(k);T.append("g").attr("class","x axis bottom-axis").attr("transform",I(0,M+20)).call(Bn).selectAll(".tick line").attr("y2","5"),O.on("offset",()=>{z=E.range(),k.range([z[0]+n,z[1]-n]).clamp(!0),it.ticks(Math.min((z[1]-z[0])/70,10)),W.call(it),L.attr("transform",$=>I(k(p($)),v(a($)))).selectAll("rect").attr("width",$=>k(x($))-k(p($))||r).call($=>C($,E)),O.call(E.draw_ticks,k.ticks().map(k))}),W.select(".domain").remove(),W.selectAll(".tick line").attr("stroke","#AAA");const On=k.ticks().map(k);O.call(E.draw_ticks,On);let L=q.selectAll("g.task").data(u);L.exit().remove();const ot=L.enter().append("g").classed("task",!0);ot.each(function($){const Y=a($).replace(/•/g,"").replace(/ /g,"-").replace(/[^a-zA-Z0-9-]/g,"");d.select(this).classed(Y,!0)}).append("rect").style("opacity",1).attr("y",n).style("cursor","pointer").attr("height",v.bandwidth()-2*n).on("mouseover",m.show).on("mouseout",m.hide).on("click",function($,Y){var X=String(Y[1]),P=X.replace(" ","%20"),R=Y[2],U=Ct(R),Yn=Y[3],Pn=Ct(Yn),Rn="https://www.primarysourcecoop.org/publications/"+t+"/search#q%3D%2Bsubject%3A%22"+P+"%22%20%2Bdate_when%3A%5B"+U+"%20TO%20"+Pn+"%5D%7Crows=20%7Cstart=0%7Chl=true%7Chl.fl=text_merge%7Csort=date_when%20asc%7Cff=person_keyword;subject%7Cfl=id%20index%20title%20filename%20resource_group_name%20date_when%20date_to%20author%20recipient%20person_keyword%20subject%20doc_beginning";window.open(Rn,"_blank")}).style("fill",et(f,h)),ot.append("text").attr("text-anchor","start").attr("fill",$=>x($)-p($)?et(f,h,En)($):"black").attr("pointer-events","none").attr("dx",n).attr("y",v.bandwidth()/2).attr("dy","0.32em").text(f),L=L.merge(ot),L.attr("transform",$=>I(z[0],v(a($)))).selectAll("rect").attr("width",0),L.transition().duration(c).attr("transform",$=>I(k(p($)),v(a($)))).selectAll("rect").attr("width",$=>k(x($))-k(p($))||r).on("start",D(E)),i&&q.append("path").attr("stroke","red").attr("d","M"+k(new Date)+",0.5V"+M)}),Cn()}return _.dates=function(g){return arguments.length?(o=g,_):o},_.width=function(g){return arguments.length?(l=g,_):l},_.today=function(g){return arguments.length?(i=g,_):i},_.colors=function(g){return arguments.length?(e=g,_):e},_.padding=function(g){return arguments.length?(n=g,_):n},_.milestone_width=function(g){return arguments.length?(r=g,_):r},_.reversed=function(g){return arguments.length?(s=g,_):s},_.duration=function(g){return arguments.length?(c=g,_):c},_;function F(g,w){const y=et(d.isoParse,d.timeFormat("%Y-%m-%d")),m=`<b>${f(w)}</b><hr style="margin: 2px 0 2px 0">${y(p(w))}`,h=x(w)-p(w)?` - ${y(x(w))}<br>${pt(p(w),x(w))}`:"";return m+h}}N.durationFormat=pt,N.timeline=Dn,N.timelineAxisLeft=lt,N.timelineAxisRight=ct,N.tooltip=tt,Object.keys(H).forEach(t=>{t!=="default"&&!Object.prototype.hasOwnProperty.call(N,t)&&Object.defineProperty(N,t,{enumerable:!0,get:()=>H[t]})}),Object.defineProperty(N,Symbol.toStringTag,{value:"Module"})});
