(function(T,q){typeof exports=="object"&&typeof module<"u"?q(exports,require("d3"),require("dayjs")):typeof define=="function"&&define.amd?define(["exports","d3","dayjs"],q):(T=typeof globalThis<"u"?globalThis:T||self,q(T.d3=T.d3||{},T.d3,T.dayjs))})(this,function(T,q,tt){"use strict";function Ot(t){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const n in t)if(n!=="default"){const r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:()=>t[n]})}}return e.default=t,Object.freeze(e)}const d=Ot(q),Yt="div.tooltip {        position: absolute;        text-align: center;        padding: 5px;        /* font: 12px sans-serif; */        background: white;        border: 1px solid #AAA;        border-radius: 2px;        pointer-events: none;      }";function et(t){d.select("head").selectAll("#tooltip").data([1]).enter().append("style").attr("id","tooltip").text(Yt);const e=d.select("body").append("div").attr("class","tooltip").style("opacity",0);return e.show=function(n){e.transition().duration(100).style("opacity",.95),e.html(t.apply(null,arguments)).style("left",n.pageX+"px").style("top",n.pageY-28+"px")},e.hide=function(n){e.transition().duration(100).style("opacity",0)},e}function Pt(t){return d.max(t.nodes().map(e=>e.getComputedTextLength()))}function Rt(t){return function(e){return e.length>t?e.slice(0,t-1)+"…":e}}const L=1,Ht=2;function ot(t,e){let n=["#FFF","#FFF"],r=d.scaleOrdinal(n),s=5,i,o="#AAA",a=40,c=3e3,l;function f(p){let w=e.domain(),b=et(A=>A),S=d.scaleOrdinal(n),F=d.scaleOrdinal(n.reverse()),$=Rt(a),E=p.selectAll(".row").data(w,e).order(),g=E.enter().append("g").attr("class","row"),v=E.exit(),_=E.select("text");E=E.merge(g).attr("transform",A=>"translate(0,"+e(A)+")"),v.remove(),g.append("rect").attr("y",.5).attr("width",c).attr("height",e.bandwidth()).attr("stroke",o).attr("stroke-width",.75).attr("fill",S),g.append("path").attr("stroke",F),_=_.merge(g.append("text").attr("y",e.bandwidth()/2).attr("dy","0.32em").on("mouseover",function(A,m){d.select(this).text()!=m&&b.show(m)}).on("mouseout",b.hide)).text($),l===void 0&&(l=Pt(_)+2*s,l=t===L?c-l:l),i=t===L?[0,l]:[l,c],_.attr("text-anchor",t===L?"start":"end").attr("dx",t===L?s:-s).attr("x",l),p.selectAll("g.y.axis > path").data([1]).join("path").attr("stroke",o).attr("stroke-width",1.75).attr("d","M"+(l+.5)+",0.5V"+e.range()[1])}return f.draw_ticks=function(p,w){p.selectAll(".row").select("path").attr("d",w.map(b=>"M"+b+",1v"+(e.bandwidth()-1)).join(""))},f.scale=function(p){return arguments.length?(e=p,f):e},f.width=function(p){return arguments.length?(c=p,f):c},f.colors=function(p){return arguments.length?(n=p,f):n},f.padding=function(p){return arguments.length?(s=p,f):s},f.range=function(p){return arguments.length?(i=p,f):i},f.trim=function(p){return arguments.length?(a=p,f):a},f.offset=function(p){return arguments.length?(l=p,f):l},f.colorscale=function(p){return arguments.length?(r=p,f):r},f}function lt(t){return ot(Ht,t)}function at(t){return ot(L,t)}var ct=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ut(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ft={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(ct,function(){var n,r,s=1e3,i=6e4,o=36e5,a=864e5,c=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,l=31536e6,f=2628e6,p=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,w={years:l,months:f,days:a,hours:o,minutes:i,seconds:s,milliseconds:1,weeks:6048e5},b=function(m){return m instanceof _},S=function(m,h,u){return new _(m,u,h.$l)},F=function(m){return r.p(m)+"s"},$=function(m){return m<0},E=function(m){return $(m)?Math.ceil(m):Math.floor(m)},g=function(m){return Math.abs(m)},v=function(m,h){return m?$(m)?{negative:!0,format:""+g(m)+h}:{negative:!1,format:""+m+h}:{negative:!1,format:""}},_=function(){function m(u,x,k){var y=this;if(this.$d={},this.$l=k,u===void 0&&(this.$ms=0,this.parseFromMilliseconds()),x)return S(u*w[F(x)],this);if(typeof u=="number")return this.$ms=u,this.parseFromMilliseconds(),this;if(typeof u=="object")return Object.keys(u).forEach(function(D){y.$d[F(D)]=u[D]}),this.calMilliseconds(),this;if(typeof u=="string"){var C=u.match(p);if(C){var N=C.slice(2).map(function(D){return D!=null?Number(D):0});return this.$d.years=N[0],this.$d.months=N[1],this.$d.weeks=N[2],this.$d.days=N[3],this.$d.hours=N[4],this.$d.minutes=N[5],this.$d.seconds=N[6],this.calMilliseconds(),this}}return this}var h=m.prototype;return h.calMilliseconds=function(){var u=this;this.$ms=Object.keys(this.$d).reduce(function(x,k){return x+(u.$d[k]||0)*w[k]},0)},h.parseFromMilliseconds=function(){var u=this.$ms;this.$d.years=E(u/l),u%=l,this.$d.months=E(u/f),u%=f,this.$d.days=E(u/a),u%=a,this.$d.hours=E(u/o),u%=o,this.$d.minutes=E(u/i),u%=i,this.$d.seconds=E(u/s),u%=s,this.$d.milliseconds=u},h.toISOString=function(){var u=v(this.$d.years,"Y"),x=v(this.$d.months,"M"),k=+this.$d.days||0;this.$d.weeks&&(k+=7*this.$d.weeks);var y=v(k,"D"),C=v(this.$d.hours,"H"),N=v(this.$d.minutes,"M"),D=this.$d.seconds||0;this.$d.milliseconds&&(D+=this.$d.milliseconds/1e3,D=Math.round(1e3*D)/1e3);var B=v(D,"S"),Dt=u.negative||x.negative||y.negative||C.negative||N.negative||B.negative,Tt=C.format||N.format||B.format?"T":"",W=(Dt?"-":"")+"P"+u.format+x.format+y.format+Tt+C.format+N.format+B.format;return W==="P"||W==="-P"?"P0D":W},h.toJSON=function(){return this.toISOString()},h.format=function(u){var x=u||"YYYY-MM-DDTHH:mm:ss",k={Y:this.$d.years,YY:r.s(this.$d.years,2,"0"),YYYY:r.s(this.$d.years,4,"0"),M:this.$d.months,MM:r.s(this.$d.months,2,"0"),D:this.$d.days,DD:r.s(this.$d.days,2,"0"),H:this.$d.hours,HH:r.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:r.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:r.s(this.$d.seconds,2,"0"),SSS:r.s(this.$d.milliseconds,3,"0")};return x.replace(c,function(y,C){return C||String(k[y])})},h.as=function(u){return this.$ms/w[F(u)]},h.get=function(u){var x=this.$ms,k=F(u);return k==="milliseconds"?x%=1e3:x=k==="weeks"?E(x/w[k]):this.$d[k],x||0},h.add=function(u,x,k){var y;return y=x?u*w[F(x)]:b(u)?u.$ms:S(u,this).$ms,S(this.$ms+y*(k?-1:1),this)},h.subtract=function(u,x){return this.add(u,x,!0)},h.locale=function(u){var x=this.clone();return x.$l=u,x},h.clone=function(){return S(this.$ms,this)},h.humanize=function(u){return n().add(this.$ms,"ms").locale(this.$l).fromNow(!u)},h.valueOf=function(){return this.asMilliseconds()},h.milliseconds=function(){return this.get("milliseconds")},h.asMilliseconds=function(){return this.as("milliseconds")},h.seconds=function(){return this.get("seconds")},h.asSeconds=function(){return this.as("seconds")},h.minutes=function(){return this.get("minutes")},h.asMinutes=function(){return this.as("minutes")},h.hours=function(){return this.get("hours")},h.asHours=function(){return this.as("hours")},h.days=function(){return this.get("days")},h.asDays=function(){return this.as("days")},h.weeks=function(){return this.get("weeks")},h.asWeeks=function(){return this.as("weeks")},h.months=function(){return this.get("months")},h.asMonths=function(){return this.as("months")},h.years=function(){return this.get("years")},h.asYears=function(){return this.as("years")},m}(),A=function(m,h,u){return m.add(h.years()*u,"y").add(h.months()*u,"M").add(h.days()*u,"d").add(h.hours()*u,"h").add(h.minutes()*u,"m").add(h.seconds()*u,"s").add(h.milliseconds()*u,"ms")};return function(m,h,u){n=u,r=u().$utils(),u.duration=function(y,C){var N=u.locale();return S(y,{$l:N},C)},u.isDuration=b;var x=h.prototype.add,k=h.prototype.subtract;h.prototype.add=function(y,C){return b(y)?A(this,y,1):x.bind(this)(y,C)},h.prototype.subtract=function(y,C){return b(y)?A(this,y,-1):k.bind(this)(y,C)}}})})(ft);var qt=ft.exports;const zt=ut(qt);var ht={exports:{}};(function(t,e){(function(n,r){t.exports=r()})(ct,function(){return function(n,r,s){n=n||{};var i=r.prototype,o={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function a(l,f,p,w){return i.fromToBase(l,f,p,w)}s.en.relativeTime=o,i.fromToBase=function(l,f,p,w,b){for(var S,F,$,E=p.$locale().relativeTime||o,g=n.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],v=g.length,_=0;_<v;_+=1){var A=g[_];A.d&&(S=w?s(l).diff(p,A.d,!0):p.diff(l,A.d,!0));var m=(n.rounding||Math.round)(Math.abs(S));if($=S>0,m<=A.r||!A.r){m<=1&&_>0&&(A=g[_-1]);var h=E[A.l];b&&(m=b(""+m)),F=typeof h=="string"?h.replace("%d",m):h(m,f,A.l,$);break}}if(f)return F;var u=$?E.future:E.past;return typeof u=="function"?u(F):u.replace("%s",F)},i.to=function(l,f){return a(l,f,this,!0)},i.from=function(l,f){return a(l,f,this)};var c=function(l){return l.$u?s.utc():s()};i.toNow=function(l){return this.to(c(this),l)},i.fromNow=function(l){return this.from(c(this),l)}}})})(ht);var Lt=ht.exports;const Vt=ut(Lt);tt.extend(zt),tt.extend(Vt);function dt(t,e){return tt.duration(e-t).humanize()}function pt(){const t=Array.prototype.slice.call(arguments,0);return function(e){return t.reduce((n,r)=>r(n),e)}}function G(t){return function(e){return t===void 0?e:e[t]}}var nt="http://www.w3.org/1999/xhtml";const mt={svg:"http://www.w3.org/2000/svg",xhtml:nt,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function gt(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),mt.hasOwnProperty(e)?{space:mt[e],local:t}:t}function It(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===nt&&e.documentElement.namespaceURI===nt?e.createElement(t):e.createElementNS(n,t)}}function Wt(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function yt(t){var e=gt(t);return(e.local?Wt:It)(e)}function Xt(){}function _t(t){return t==null?Xt:function(){return this.querySelector(t)}}function Ut(t){typeof t!="function"&&(t=_t(t));for(var e=this._groups,n=e.length,r=new Array(n),s=0;s<n;++s)for(var i=e[s],o=i.length,a=r[s]=new Array(o),c,l,f=0;f<o;++f)(c=i[f])&&(l=t.call(c,c.__data__,f,i))&&("__data__"in c&&(l.__data__=c.__data__),a[f]=l);return new O(r,this._parents)}function wt(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function Zt(){return[]}function Gt(t){return t==null?Zt:function(){return this.querySelectorAll(t)}}function Kt(t){return function(){return wt(t.apply(this,arguments))}}function Jt(t){typeof t=="function"?t=Kt(t):t=Gt(t);for(var e=this._groups,n=e.length,r=[],s=[],i=0;i<n;++i)for(var o=e[i],a=o.length,c,l=0;l<a;++l)(c=o[l])&&(r.push(t.call(c,c.__data__,l,o)),s.push(c));return new O(r,s)}function Qt(t){return function(){return this.matches(t)}}function vt(t){return function(e){return e.matches(t)}}var jt=Array.prototype.find;function te(t){return function(){return jt.call(this.children,t)}}function ee(){return this.firstElementChild}function ne(t){return this.select(t==null?ee:te(typeof t=="function"?t:vt(t)))}var re=Array.prototype.filter;function se(){return Array.from(this.children)}function ie(t){return function(){return re.call(this.children,t)}}function oe(t){return this.selectAll(t==null?se:ie(typeof t=="function"?t:vt(t)))}function le(t){typeof t!="function"&&(t=Qt(t));for(var e=this._groups,n=e.length,r=new Array(n),s=0;s<n;++s)for(var i=e[s],o=i.length,a=r[s]=[],c,l=0;l<o;++l)(c=i[l])&&t.call(c,c.__data__,l,i)&&a.push(c);return new O(r,this._parents)}function xt(t){return new Array(t.length)}function ae(){return new O(this._enter||this._groups.map(xt),this._parents)}function K(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}K.prototype={constructor:K,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function ce(t){return function(){return t}}function ue(t,e,n,r,s,i){for(var o=0,a,c=e.length,l=i.length;o<l;++o)(a=e[o])?(a.__data__=i[o],r[o]=a):n[o]=new K(t,i[o]);for(;o<c;++o)(a=e[o])&&(s[o]=a)}function fe(t,e,n,r,s,i,o){var a,c,l=new Map,f=e.length,p=i.length,w=new Array(f),b;for(a=0;a<f;++a)(c=e[a])&&(w[a]=b=o.call(c,c.__data__,a,e)+"",l.has(b)?s[a]=c:l.set(b,c));for(a=0;a<p;++a)b=o.call(t,i[a],a,i)+"",(c=l.get(b))?(r[a]=c,c.__data__=i[a],l.delete(b)):n[a]=new K(t,i[a]);for(a=0;a<f;++a)(c=e[a])&&l.get(w[a])===c&&(s[a]=c)}function he(t){return t.__data__}function de(t,e){if(!arguments.length)return Array.from(this,he);var n=e?fe:ue,r=this._parents,s=this._groups;typeof t!="function"&&(t=ce(t));for(var i=s.length,o=new Array(i),a=new Array(i),c=new Array(i),l=0;l<i;++l){var f=r[l],p=s[l],w=p.length,b=pe(t.call(f,f&&f.__data__,l,r)),S=b.length,F=a[l]=new Array(S),$=o[l]=new Array(S),E=c[l]=new Array(w);n(f,p,F,$,E,b,e);for(var g=0,v=0,_,A;g<S;++g)if(_=F[g]){for(g>=v&&(v=g+1);!(A=$[v])&&++v<S;);_._next=A||null}}return o=new O(o,r),o._enter=a,o._exit=c,o}function pe(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function me(){return new O(this._exit||this._groups.map(xt),this._parents)}function ge(t,e,n){var r=this.enter(),s=this,i=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(s=e(s),s&&(s=s.selection())),n==null?i.remove():n(i),r&&s?r.merge(s).order():s}function ye(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,s=n.length,i=r.length,o=Math.min(s,i),a=new Array(s),c=0;c<o;++c)for(var l=n[c],f=r[c],p=l.length,w=a[c]=new Array(p),b,S=0;S<p;++S)(b=l[S]||f[S])&&(w[S]=b);for(;c<s;++c)a[c]=n[c];return new O(a,this._parents)}function _e(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],s=r.length-1,i=r[s],o;--s>=0;)(o=r[s])&&(i&&o.compareDocumentPosition(i)^4&&i.parentNode.insertBefore(o,i),i=o);return this}function we(t){t||(t=ve);function e(p,w){return p&&w?t(p.__data__,w.__data__):!p-!w}for(var n=this._groups,r=n.length,s=new Array(r),i=0;i<r;++i){for(var o=n[i],a=o.length,c=s[i]=new Array(a),l,f=0;f<a;++f)(l=o[f])&&(c[f]=l);c.sort(e)}return new O(s,this._parents).order()}function ve(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function xe(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function Ae(){return Array.from(this)}function be(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],s=0,i=r.length;s<i;++s){var o=r[s];if(o)return o}return null}function $e(){let t=0;for(const e of this)++t;return t}function Se(){return!this.node()}function ke(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var s=e[n],i=0,o=s.length,a;i<o;++i)(a=s[i])&&t.call(a,a.__data__,i,s);return this}function Me(t){return function(){this.removeAttribute(t)}}function Ee(t){return function(){this.removeAttributeNS(t.space,t.local)}}function Ce(t,e){return function(){this.setAttribute(t,e)}}function Fe(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function Ne(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function De(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function Te(t,e){var n=gt(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?Ee:Me:typeof e=="function"?n.local?De:Ne:n.local?Fe:Ce)(n,e))}function At(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function Be(t){return function(){this.style.removeProperty(t)}}function Oe(t,e,n){return function(){this.style.setProperty(t,e,n)}}function Ye(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function Pe(t,e,n){return arguments.length>1?this.each((e==null?Be:typeof e=="function"?Ye:Oe)(t,e,n??"")):Re(this.node(),t)}function Re(t,e){return t.style.getPropertyValue(e)||At(t).getComputedStyle(t,null).getPropertyValue(e)}function He(t){return function(){delete this[t]}}function qe(t,e){return function(){this[t]=e}}function ze(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function Le(t,e){return arguments.length>1?this.each((e==null?He:typeof e=="function"?ze:qe)(t,e)):this.node()[t]}function bt(t){return t.trim().split(/^|\s+/)}function rt(t){return t.classList||new $t(t)}function $t(t){this._node=t,this._names=bt(t.getAttribute("class")||"")}$t.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function St(t,e){for(var n=rt(t),r=-1,s=e.length;++r<s;)n.add(e[r])}function kt(t,e){for(var n=rt(t),r=-1,s=e.length;++r<s;)n.remove(e[r])}function Ve(t){return function(){St(this,t)}}function Ie(t){return function(){kt(this,t)}}function We(t,e){return function(){(e.apply(this,arguments)?St:kt)(this,t)}}function Xe(t,e){var n=bt(t+"");if(arguments.length<2){for(var r=rt(this.node()),s=-1,i=n.length;++s<i;)if(!r.contains(n[s]))return!1;return!0}return this.each((typeof e=="function"?We:e?Ve:Ie)(n,e))}function Ue(){this.textContent=""}function Ze(t){return function(){this.textContent=t}}function Ge(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function Ke(t){return arguments.length?this.each(t==null?Ue:(typeof t=="function"?Ge:Ze)(t)):this.node().textContent}function Je(){this.innerHTML=""}function Qe(t){return function(){this.innerHTML=t}}function je(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function tn(t){return arguments.length?this.each(t==null?Je:(typeof t=="function"?je:Qe)(t)):this.node().innerHTML}function en(){this.nextSibling&&this.parentNode.appendChild(this)}function nn(){return this.each(en)}function rn(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function sn(){return this.each(rn)}function on(t){var e=typeof t=="function"?t:yt(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function ln(){return null}function an(t,e){var n=typeof t=="function"?t:yt(t),r=e==null?ln:typeof e=="function"?e:_t(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function cn(){var t=this.parentNode;t&&t.removeChild(this)}function un(){return this.each(cn)}function fn(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function hn(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function dn(t){return this.select(t?hn:fn)}function pn(t){return arguments.length?this.property("__data__",t):this.node().__data__}function mn(t){return function(e){t.call(this,e,this.__data__)}}function gn(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function yn(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,s=e.length,i;n<s;++n)i=e[n],(!t.type||i.type===t.type)&&i.name===t.name?this.removeEventListener(i.type,i.listener,i.options):e[++r]=i;++r?e.length=r:delete this.__on}}}function _n(t,e,n){return function(){var r=this.__on,s,i=mn(e);if(r){for(var o=0,a=r.length;o<a;++o)if((s=r[o]).type===t.type&&s.name===t.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=i,s.options=n),s.value=e;return}}this.addEventListener(t.type,i,n),s={type:t.type,name:t.name,value:e,listener:i,options:n},r?r.push(s):this.__on=[s]}}function wn(t,e,n){var r=gn(t+""),s,i=r.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,l=a.length,f;c<l;++c)for(s=0,f=a[c];s<i;++s)if((o=r[s]).type===f.type&&o.name===f.name)return f.value}return}for(a=e?_n:yn,s=0;s<i;++s)this.each(a(r[s],e,n));return this}function Mt(t,e,n){var r=At(t),s=r.CustomEvent;typeof s=="function"?s=new s(e,n):(s=r.document.createEvent("Event"),n?(s.initEvent(e,n.bubbles,n.cancelable),s.detail=n.detail):s.initEvent(e,!1,!1)),t.dispatchEvent(s)}function vn(t,e){return function(){return Mt(this,t,e)}}function xn(t,e){return function(){return Mt(this,t,e.apply(this,arguments))}}function An(t,e){return this.each((typeof e=="function"?xn:vn)(t,e))}function*bn(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],s=0,i=r.length,o;s<i;++s)(o=r[s])&&(yield o)}var $n=[null];function O(t,e){this._groups=t,this._parents=e}function Sn(){return this}O.prototype={constructor:O,select:Ut,selectAll:Jt,selectChild:ne,selectChildren:oe,filter:le,data:de,enter:ae,exit:me,join:ge,merge:ye,selection:Sn,order:_e,sort:we,call:xe,nodes:Ae,node:be,size:$e,empty:Se,each:ke,attr:Te,style:Pe,property:Le,classed:Xe,text:Ke,html:tn,raise:nn,lower:sn,append:on,insert:an,remove:un,clone:dn,datum:pn,on:wn,dispatch:An,[Symbol.iterator]:bn};function Et(t){return typeof t=="string"?new O([document.querySelectorAll(t)],[document.documentElement]):new O([wt(t)],$n)}var J=0,V=0;const kn=["#4285f4","#db4437","#f4b400","#0f9d58","#ab47bc","#5e97f5","#e06055","#f5bf26","#33ab71","#b762c6","#00acc1","#ff855f","#9e9d24","#26b8ca","#ff7043"];function Mn(t){const e=window.getComputedStyle(t,null).getPropertyValue("font-size");return parseFloat(e)}function Ct(t){const e=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),r=String(t.getDate()).padStart(2,"0");return`${e}${n}${r}`}function I(t,e){return"translate("+t+","+e+")"}function En(){document.querySelectorAll('g.task[class*=" --"]').forEach(function(e){e.style.display="none"})}function Q(t,e,n){const s=d.select(t).attr("class");let i=!1;e.selectAll("g.row").each(function(g){const _=d.select(this).attr("class");if(_==s)i=!0;else if(i){let m=this.getAttribute("transform"),h=parseFloat(m.split("(")[1].split(",")[0].trim()),u=parseFloat(m.split(",")[1].split(")")[0].trim());this.setAttribute("transform",`translate(${h},${u+n})`);var A=_.split(" ")[1];document.querySelectorAll(`g.task.${A} rect`).forEach(function(y){y.setAttribute("y",parseFloat(y.getAttribute("y"))+n)}),document.querySelectorAll(`g.task.${A} text`).forEach(function(y){y.setAttribute("y",parseFloat(y.getAttribute("y"))+n)})}});const o=document.querySelector('path[stroke-width="1.75"]');let c=o.getAttribute("d").match(/M([\d.-]+),([\d.-]+)V([\d.-]+)/),l=parseFloat(c[1]),f=parseFloat(c[2]),w=parseFloat(c[3])+n;o.setAttribute("d",`M${l},${f}V${w}`);const b=d.select("g.x.axis.bottom-axis");let S=b.attr("transform"),F=parseFloat(S.split("(")[1].split(",")[0].trim()),E=parseFloat(S.split(",")[1].split(")")[0].trim())+n;b.attr("transform",`translate(${F}, ${E})`)}function Ft(t,e){e.forEach(function(r){document.querySelectorAll(`g.row.${r}`).forEach(function(i){i.style.display="block"})});const n=d.select(t).attr("class").split(" ")[1];d.selectAll(`g.task.${n}`).each(function(r){var s=r[1].replace(/ /g,"-").replace(/[^a-zA-Z0-9-]/g,"");if(s==n.replace(/--/g,""))d.select(this).style("display","none");else if(s!=n.replace(/--/g,"")){d.select(this).style("display","block");var i=(e.indexOf(s)+1)*38;let o=d.select(this),a=o.attr("transform"),c=parseFloat(a.split("(")[1].split(",")[0].trim()),l=parseFloat(a.split(",")[1].split(")")[0].trim()),f=l+i;o.attr("transform",`translate(${c}, ${l})`).transition().duration(1e3).attr("transform",`translate(${c}, ${f})`).on("start",()=>{Et(`g.task.${s}`).style("display","none")}).on("end",()=>{o.style("display","none"),o.attr("transform",`translate(${c}, ${l})`),Et(`g.task.${s}`).style("display","block")})}})}function Nt(t,e){return new Promise(n=>{const r=d.select(t).attr("class").split(" ")[1];d.selectAll(`g.task:not(.${r})`).each(function(s){var i=s[1].replace(/ /g,"-").replace(/[^a-zA-Z0-9-]/g,"");if(e.includes(i)){d.select(this).style("display","block");var o=(e.indexOf(i)+1)*38;let a=d.select(this),c=a.attr("transform"),l=parseFloat(c.split("(")[1].split(",")[0].trim()),f=parseFloat(c.split(",")[1].split(")")[0].trim()),p=f-o;a.transition().duration(1e3).attr("transform",`translate(${l}, ${p})`).on("end",()=>{d.selectAll(`g.${r}`).style("display","block"),a.style("display","none"),a.attr("transform",`translate(${l}, ${f})`),e.forEach(function(w){document.querySelectorAll(`.${w}`).forEach(function(S){S.style.display="none"})}),n()})}})})}function j(t,e){const r=d.select(t).attr("class"),s=[];let i=!1,o=!1;return e.selectAll("g.row").each(function(a){const l=d.select(this).attr("class");l==r?i=!0:i&&l.split(" ")[2]=="timelineheader"?o=!0:i&&!o&&s.push(l.split(" ")[1])}),s}function Cn(){const t=document.getElementById("collapseAllButton");t.disabled=!0;let e=[];d.selectAll("g.row.timelineheader text").each(function(){if(d.select(this).text()==="-"){const r=this.parentNode,s=j(r,d.select(r.parentNode)),i=s.length*38;let o=Nt(r,s).then(()=>{Q(r,d.select(r.parentNode),-i),d.select(this).text("+").style("font-size","20px")});e.push(o)}}),Promise.all(e).then(()=>{t.disabled=!1})}window.collapseAll=Cn;function Fn(){const t=document.getElementById("expandAllButton");t.disabled=!0;let e=[];d.selectAll("g.row.timelineheader text").each(function(){if(d.select(this).text()==="+"){const r=this.parentNode,s=j(r,d.select(r.parentNode)),i=s.length*38;let o=new Promise(a=>{Ft(r,s),Q(r,d.select(r.parentNode),i),a()}).then(()=>{d.select(this).text("-").style("font-size","30px")});e.push(o)}}),Promise.all(e).then(()=>{t.disabled=!1})}window.expandAll=Fn;function Nn(t){let e=kn,n=5,r=2,s=!1,i=!1,o,a,c=0,l=G(0),f=G(1),p=G(2),w=G(3);console.log(t);function b(g,v){const _=g.select("text"),A=g.select("rect"),m=A.attr("width")-2*n,h=f(v);_.text(h);let u=_.node().getComputedTextLength();if(u>m){const x=m<0?0:m/u,k=Math.floor(h.length*x);_.text(k>2?h.slice(0,k-2)+"…":"")}}function S(g,v,_){const A=g.select("text").node(),m=A.getBBox(),h=_.scale().domain().indexOf(l(v)),u=_.colorscale()(h),x=g.selectAll("rect.bckg").data([v]).join("rect").attr("class","bckg").attr("fill",u).attr("x",m.x-n+r).attr("y",m.y-2).attr("width",m.width+n-r).attr("height",m.height);g.node().insertBefore(x.node(),A)}function F(g,v){g.each(function(_,A){const m=d.select(this.parentNode);w(_)-p(_)?b(m,_):S(m,_,v)})}function $(g){const v=g.datum(),_=new Set(d.map(v,l)),A=new et(E),m=d.scaleOrdinal(e);o=o||[d.min(v,p),d.max(v,w)],i&&(o=d.extent(o.concat(new Date))),g.each(function(h){const u=a||this.getBoundingClientRect().width,x=_.size*(Mn(this)+4*n),k=d.scaleBand().domain(_).range([0,x]),y=d.scaleTime().domain(o),C=(s?at:lt)(k).width(u),N=d.select(this).selectAll("svg").data([1]).join("svg");N.attr("class","timeline").attr("width",u).attr("height",x+40);const D=N.append("g").attr("transform","translate(0,20)"),B=D.append("g").attr("class","y axis").call(C);let W=document.querySelector('path[stroke-width="1.75"]').getAttribute("d").match(/M([\d.-]+),([\d.-]+)V([\d.-]+)/),st=parseFloat(W[1]);B.selectAll("text").on("mouseover",function(){d.select(this).style("text-decoration","underline")}).on("mouseout",function(){d.select(this).style("text-decoration","none")}).attr("text-anchor",function(M){return M.startsWith(" •")?"middle":"end"}).attr("x",function(M){return M.startsWith(" •")?st/2:st-.5}).style("cursor","pointer").style("font-weight",function(M){return M.startsWith(" •")?"bold":"normal"}).style("background","none").on("click",function(M,P){const Y=P.replace(/ • /g,"").replace("Topic, ","").replace(" ","%20"),R=`https://www.primarysourcecoop.org/publications/${t}/search#q%3D%2Bsubject%3A%22${Y}%22`;window.open(R,"_blank")}),B.selectAll("g.row").each(function(M){const P=d.select(this).datum();d.select(this).classed(d.select(this).datum().replace(/•/g,"").replace(/ /g,"-").replace(/[^a-zA-Z0-9-]/g,""),!0),P.startsWith(" •")&&d.select(this).classed("timelineheader",!0).append("text").attr("x",st-10).attr("y",25).text("-").style("text-anchor","end").style("cursor","pointer").style("font-size","30px").attr("fill","black").style("-ms-user-select","none").style("-webkit-user-select","none").style("user-select","none")}),B.selectAll("g.row.timelineheader text").on("click",function(M,P){const U=d.select(this).text();if(U==="+"){J-=1,V+=1,console.log("Collapsed: ",J),console.log("Expanded: ",V);let Y=j(this.parentNode,B),R=Y.length*38;Ft(this.parentNode,Y),Q(this.parentNode,B,R),d.select(this).text()==="+"?d.select(this).text("-").style("font-size","30px"):d.select(this).text("+")}else if(U==="-"){J+=1,V-=1,console.log("Collapsed: ",J),console.log("Expanded: ",V);let Y=j(this.parentNode,B),R=Y.length*38;Nt(this.parentNode,Y).then(()=>{Q(this.parentNode,B,-R)}),d.select(this).text()==="-"?d.select(this).text("+").style("font-size","20px"):d.select(this).text("-")}else{const R=P.replace(/ • /g,"").replace("Topic, ","").replace(" ","%20"),Z=`https://www.primarysourcecoop.org/publications/${t}/search#q%3D%2Bsubject%3A%22${R}%22`;window.open(Z,"_blank")}}),V=d.selectAll("text").filter(function(){return this.textContent.startsWith(" •")}).size();let H=C.range();y.range([H[0]+n,H[1]-n]).clamp(!0);const it=d.axisBottom(y),X=D.append("g").attr("class","x axis").attr("transform",I(0,0)).call(it);X.selectAll(".tick text").attr("dy","-1.5em"),X.selectAll(".tick line").attr("y2","-5");const Dn=d.axisBottom(y);N.append("g").attr("class","x axis bottom-axis").attr("transform",I(0,x+20)).call(Dn).selectAll(".tick line").attr("y2","5"),B.on("offset",()=>{H=C.range(),y.range([H[0]+n,H[1]-n]).clamp(!0),it.ticks(Math.min((H[1]-H[0])/70,10)),X.call(it),z.attr("transform",M=>I(y(p(M)),k(l(M)))).selectAll("rect").attr("width",M=>y(w(M))-y(p(M))||r).call(M=>F(M,C)),B.call(C.draw_ticks,y.ticks().map(y))}),X.select(".domain").remove(),X.selectAll(".tick line").attr("stroke","#AAA");const Tn=y.ticks().map(y);B.call(C.draw_ticks,Tn);let z=D.selectAll("g.task").data(h);z.exit().remove();const Bt=z.enter().append("g").classed("task",!0);Bt.each(function(M){const P=l(M).replace(/•/g,"").replace(/ /g,"-").replace(/[^a-zA-Z0-9-]/g,"");d.select(this).classed(P,!0)}).append("rect").style("opacity",1).attr("y",n).style("cursor","pointer").attr("height",k.bandwidth()-2*n).on("mouseover",A.show).on("mouseout",A.hide).on("click",function(M,P){var U=String(P[1]),Y=U.replace(/ /g,"%20"),Y=Y.replace("Topic,%20",""),R=P[2],Z=Ct(R),Bn=P[3],On=Ct(Bn),Yn="https://www.primarysourcecoop.org/publications/"+t+"/search#q%3D%2Bsubject%3A%22"+Y+"%22%20%2Bdate_when%3A%5B"+Z+"%20TO%20"+On+"%5D%7Crows=20%7Cstart=0%7Chl=true%7Chl.fl=text_merge%7Csort=date_when%20asc%7Cff=person_keyword;subject%7Cfl=id%20index%20title%20filename%20resource_group_name%20date_when%20date_to%20author%20recipient%20person_keyword%20subject%20doc_beginning";window.open(Yn,"_blank")}).style("fill",pt(f,m)),z=z.merge(Bt),z.attr("transform",M=>I(H[0],k(l(M)))).selectAll("rect").attr("width",0),z.transition().duration(c).attr("transform",M=>I(y(p(M)),k(l(M)))).selectAll("rect").attr("width",M=>y(w(M))-y(p(M))||r),i&&D.append("path").attr("stroke","red").attr("d","M"+y(new Date)+",0.5V"+x)}),En()}return $.dates=function(g){return arguments.length?(o=g,$):o},$.width=function(g){return arguments.length?(a=g,$):a},$.today=function(g){return arguments.length?(i=g,$):i},$.colors=function(g){return arguments.length?(e=g,$):e},$.padding=function(g){return arguments.length?(n=g,$):n},$.milestone_width=function(g){return arguments.length?(r=g,$):r},$.reversed=function(g){return arguments.length?(s=g,$):s},$.duration=function(g){return arguments.length?(c=g,$):c},$;function E(g,v){const _=pt(d.isoParse,d.timeFormat("%Y-%m-%d")),A=`<b>${f(v)}</b><hr style="margin: 2px 0 2px 0">${_(p(v))}`,m=w(v)-p(v)?` - ${_(w(v))}<br>${dt(p(v),w(v))}`:"";return A+m}}T.durationFormat=dt,T.timeline=Nn,T.timelineAxisLeft=lt,T.timelineAxisRight=at,T.tooltip=et,Object.keys(q).forEach(t=>{t!=="default"&&!Object.prototype.hasOwnProperty.call(T,t)&&Object.defineProperty(T,t,{enumerable:!0,get:()=>q[t]})}),Object.defineProperty(T,Symbol.toStringTag,{value:"Module"})});
