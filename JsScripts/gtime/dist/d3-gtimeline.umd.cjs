(function(j,P){typeof exports=="object"&&typeof module<"u"?P(exports,require("d3"),require("dayjs")):typeof define=="function"&&define.amd?define(["exports","d3","dayjs"],P):(j=typeof globalThis<"u"?globalThis:j||self,P(j.d3=j.d3||{},j.d3,j.dayjs))})(this,function(j,P,V){"use strict";function ot(e){const r=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e){for(const u in e)if(u!=="default"){const f=Object.getOwnPropertyDescriptor(e,u);Object.defineProperty(r,u,f.get?f:{enumerable:!0,get:()=>e[u]})}}return r.default=e,Object.freeze(r)}const y=ot(P),at="div.tooltip {        position: absolute;        text-align: center;        padding: 5px;        /* font: 12px sans-serif; */        background: white;        border: 1px solid #AAA;        border-radius: 2px;        pointer-events: none;      }";function R(e){y.select("head").selectAll("#tooltip").data([1]).enter().append("style").attr("id","tooltip").text(at);const r=y.select("body").append("div").attr("class","tooltip").style("opacity",0);return r.show=function(u){r.transition().duration(100).style("opacity",.95),r.html(e.apply(null,arguments)).style("left",u.pageX+"px").style("top",u.pageY-28+"px")},r.hide=function(u){r.transition().duration(100).style("opacity",0)},r}function ct(e){return y.max(e.nodes().map(r=>r.getComputedTextLength()))}function ut(e){return function(r){return r.length>e?r.slice(0,e-1)+"â€¦":r}}const H=1,lt=2;function X(e,r){let u=["#FFF","#EEE"],f=y.scaleOrdinal(u),v=5,b,B="#AAA",O=40,M=3e3,i;function o(c){let A=r.domain(),D=R(s=>s),T=y.scaleOrdinal(u),Y=y.scaleOrdinal(u.reverse()),x=ut(O),k=c.selectAll(".row").data(A,r).order(),a=k.enter().append("g").attr("class","row"),m=k.exit(),d=k.select("text");k=k.merge(a).attr("transform",s=>"translate(0,"+r(s)+")"),m.remove(),a.append("rect").attr("y",.5).attr("width",M).attr("height",r.bandwidth()).attr("stroke",B).attr("stroke-width",.75).attr("fill",T),a.append("path").attr("stroke",Y),d=d.merge(a.append("text").attr("y",r.bandwidth()/2).attr("dy","0.32em").on("mouseover",function(s,n){y.select(this).text()!=n&&D.show(n)}).on("mouseout",D.hide)).text(x),i===void 0&&(i=ct(d)+2*v,i=e===H?M-i:i),b=e===H?[0,i]:[i,M],d.attr("text-anchor",e===H?"start":"end").attr("dx",e===H?v:-v).attr("x",i);const w=function(s,n){i=Math.max(10,Math.min(M-10,i+s.dx)),y.select(this).attr("d","M"+i+",0.5V"+r.range()[1]),d.attr("x",i),b=e===H?[0,i]:[i,M],c.dispatch("offset",{detail:{offset:i}})};c.selectAll("g.y.axis > path").data([1]).join("path").attr("stroke",B).attr("stroke-width",1.75).attr("d","M"+(i+.5)+",0.5V"+r.range()[1]).style("cursor","ew-resize").call(y.drag().on("drag",w))}return o.draw_ticks=function(c,A){c.selectAll(".row").select("path").attr("d",A.map(D=>"M"+D+",1v"+(r.bandwidth()-1)).join(""))},o.scale=function(c){return arguments.length?(r=c,o):r},o.width=function(c){return arguments.length?(M=c,o):M},o.colors=function(c){return arguments.length?(u=c,o):u},o.padding=function(c){return arguments.length?(v=c,o):v},o.range=function(c){return arguments.length?(b=c,o):b},o.trim=function(c){return arguments.length?(O=c,o):O},o.offset=function(c){return arguments.length?(i=c,o):i},o.colorscale=function(c){return arguments.length?(f=c,o):f},o}function K(e){return X(lt,e)}function Q(e){return X(H,e)}var U=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function tt(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var et={exports:{}};(function(e,r){(function(u,f){e.exports=f()})(U,function(){var u,f,v=1e3,b=6e4,B=36e5,O=864e5,M=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,i=31536e6,o=2628e6,c=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,A={years:i,months:o,days:O,hours:B,minutes:b,seconds:v,milliseconds:1,weeks:6048e5},D=function(s){return s instanceof d},T=function(s,n,t){return new d(s,t,n.$l)},Y=function(s){return f.p(s)+"s"},x=function(s){return s<0},k=function(s){return x(s)?Math.ceil(s):Math.floor(s)},a=function(s){return Math.abs(s)},m=function(s,n){return s?x(s)?{negative:!0,format:""+a(s)+n}:{negative:!1,format:""+s+n}:{negative:!1,format:""}},d=function(){function s(t,h,p){var l=this;if(this.$d={},this.$l=p,t===void 0&&(this.$ms=0,this.parseFromMilliseconds()),h)return T(t*A[Y(h)],this);if(typeof t=="number")return this.$ms=t,this.parseFromMilliseconds(),this;if(typeof t=="object")return Object.keys(t).forEach(function(S){l.$d[Y(S)]=t[S]}),this.calMilliseconds(),this;if(typeof t=="string"){var $=t.match(c);if($){var _=$.slice(2).map(function(S){return S!=null?Number(S):0});return this.$d.years=_[0],this.$d.months=_[1],this.$d.weeks=_[2],this.$d.days=_[3],this.$d.hours=_[4],this.$d.minutes=_[5],this.$d.seconds=_[6],this.calMilliseconds(),this}}return this}var n=s.prototype;return n.calMilliseconds=function(){var t=this;this.$ms=Object.keys(this.$d).reduce(function(h,p){return h+(t.$d[p]||0)*A[p]},0)},n.parseFromMilliseconds=function(){var t=this.$ms;this.$d.years=k(t/i),t%=i,this.$d.months=k(t/o),t%=o,this.$d.days=k(t/O),t%=O,this.$d.hours=k(t/B),t%=B,this.$d.minutes=k(t/b),t%=b,this.$d.seconds=k(t/v),t%=v,this.$d.milliseconds=t},n.toISOString=function(){var t=m(this.$d.years,"Y"),h=m(this.$d.months,"M"),p=+this.$d.days||0;this.$d.weeks&&(p+=7*this.$d.weeks);var l=m(p,"D"),$=m(this.$d.hours,"H"),_=m(this.$d.minutes,"M"),S=this.$d.seconds||0;this.$d.milliseconds&&(S+=this.$d.milliseconds/1e3,S=Math.round(1e3*S)/1e3);var E=m(S,"S"),C=t.negative||h.negative||l.negative||$.negative||_.negative||E.negative,W=$.format||_.format||E.format?"T":"",F=(C?"-":"")+"P"+t.format+h.format+l.format+W+$.format+_.format+E.format;return F==="P"||F==="-P"?"P0D":F},n.toJSON=function(){return this.toISOString()},n.format=function(t){var h=t||"YYYY-MM-DDTHH:mm:ss",p={Y:this.$d.years,YY:f.s(this.$d.years,2,"0"),YYYY:f.s(this.$d.years,4,"0"),M:this.$d.months,MM:f.s(this.$d.months,2,"0"),D:this.$d.days,DD:f.s(this.$d.days,2,"0"),H:this.$d.hours,HH:f.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:f.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:f.s(this.$d.seconds,2,"0"),SSS:f.s(this.$d.milliseconds,3,"0")};return h.replace(M,function(l,$){return $||String(p[l])})},n.as=function(t){return this.$ms/A[Y(t)]},n.get=function(t){var h=this.$ms,p=Y(t);return p==="milliseconds"?h%=1e3:h=p==="weeks"?k(h/A[p]):this.$d[p],h||0},n.add=function(t,h,p){var l;return l=h?t*A[Y(h)]:D(t)?t.$ms:T(t,this).$ms,T(this.$ms+l*(p?-1:1),this)},n.subtract=function(t,h){return this.add(t,h,!0)},n.locale=function(t){var h=this.clone();return h.$l=t,h},n.clone=function(){return T(this.$ms,this)},n.humanize=function(t){return u().add(this.$ms,"ms").locale(this.$l).fromNow(!t)},n.valueOf=function(){return this.asMilliseconds()},n.milliseconds=function(){return this.get("milliseconds")},n.asMilliseconds=function(){return this.as("milliseconds")},n.seconds=function(){return this.get("seconds")},n.asSeconds=function(){return this.as("seconds")},n.minutes=function(){return this.get("minutes")},n.asMinutes=function(){return this.as("minutes")},n.hours=function(){return this.get("hours")},n.asHours=function(){return this.as("hours")},n.days=function(){return this.get("days")},n.asDays=function(){return this.as("days")},n.weeks=function(){return this.get("weeks")},n.asWeeks=function(){return this.as("weeks")},n.months=function(){return this.get("months")},n.asMonths=function(){return this.as("months")},n.years=function(){return this.get("years")},n.asYears=function(){return this.as("years")},s}(),w=function(s,n,t){return s.add(n.years()*t,"y").add(n.months()*t,"M").add(n.days()*t,"d").add(n.hours()*t,"h").add(n.minutes()*t,"m").add(n.seconds()*t,"s").add(n.milliseconds()*t,"ms")};return function(s,n,t){u=t,f=t().$utils(),t.duration=function(l,$){var _=t.locale();return T(l,{$l:_},$)},t.isDuration=D;var h=n.prototype.add,p=n.prototype.subtract;n.prototype.add=function(l,$){return D(l)?w(this,l,1):h.bind(this)(l,$)},n.prototype.subtract=function(l,$){return D(l)?w(this,l,-1):p.bind(this)(l,$)}}})})(et);var dt=et.exports;const ht=tt(dt);var nt={exports:{}};(function(e,r){(function(u,f){e.exports=f()})(U,function(){return function(u,f,v){u=u||{};var b=f.prototype,B={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function O(i,o,c,A){return b.fromToBase(i,o,c,A)}v.en.relativeTime=B,b.fromToBase=function(i,o,c,A,D){for(var T,Y,x,k=c.$locale().relativeTime||B,a=u.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],m=a.length,d=0;d<m;d+=1){var w=a[d];w.d&&(T=A?v(i).diff(c,w.d,!0):c.diff(i,w.d,!0));var s=(u.rounding||Math.round)(Math.abs(T));if(x=T>0,s<=w.r||!w.r){s<=1&&d>0&&(w=a[d-1]);var n=k[w.l];D&&(s=D(""+s)),Y=typeof n=="string"?n.replace("%d",s):n(s,o,w.l,x);break}}if(o)return Y;var t=x?k.future:k.past;return typeof t=="function"?t(Y):t.replace("%s",Y)},b.to=function(i,o){return O(i,o,this,!0)},b.from=function(i,o){return O(i,o,this)};var M=function(i){return i.$u?v.utc():v()};b.toNow=function(i){return this.to(M(this),i)},b.fromNow=function(i){return this.from(M(this),i)}}})})(nt);var ft=nt.exports;const mt=tt(ft);V.extend(ht),V.extend(mt);function rt(e,r){return V.duration(r-e).humanize()}function I(){const e=Array.prototype.slice.call(arguments,0);return function(r){return e.reduce((u,f)=>f(u),r)}}function L(e){return function(r){return e===void 0?r:r[e]}}const pt=["#4285f4","#db4437","#f4b400","#0f9d58","#ab47bc","#5e97f5","#e06055","#f5bf26","#33ab71","#b762c6","#00acc1","#ff855f","#9e9d24","#26b8ca","#ff7043"];function gt(e){const r=window.getComputedStyle(e,null).getPropertyValue("font-size");return parseFloat(r)}function yt(e){return e.r*.299+e.g*.587+e.b*.114}function xt(e){return yt(e)>165}function wt(e){return xt(y.color(e))?"black":"white"}function st(e){const r=e.getFullYear(),u=String(e.getMonth()+1).padStart(2,"0"),f=String(e.getDate()).padStart(2,"0");return`${r}${u}${f}`}function q(e,r){return"translate("+e+","+r+")"}function bt(){let e=pt,r=5,u=2,f=!1,v=!1,b,B,O=0,M=L(0),i=L(1),o=L(2),c=L(3);function A(a,m){const d=a.select("text"),w=a.select("rect"),s=w.attr("width")-2*r,n=i(m);d.text(n);let t=d.node().getComputedTextLength();if(t>s){const h=s<0?0:s/t,p=Math.floor(n.length*h);d.text(p>2?n.slice(0,p-2)+"â€¦":"")}}function D(a,m,d){const w=a.select("text").node(),s=w.getBBox(),n=d.scale().domain().indexOf(M(m)),t=d.colorscale()(n),h=a.selectAll("rect.bckg").data([m]).join("rect").attr("class","bckg").attr("fill",t).attr("x",s.x-r+u).attr("y",s.y-2).attr("width",s.width+r-u).attr("height",s.height);a.node().insertBefore(h.node(),w)}function T(a,m){a.each(function(d,w){const s=y.select(this.parentNode);c(d)-o(d)?A(s,d):D(s,d,m)})}function Y(a){return function(m,d){y.active(this).tween("text",function(){return function(w){T(y.select(this),a)}})}}function x(a){const m=a.datum(),d=new Set(y.map(m,M)),w=new R(k),s=y.scaleOrdinal(e);b=b||[y.min(m,o),y.max(m,c)],v&&(b=y.extent(b.concat(new Date))),a.each(function(n){const t=B||this.getBoundingClientRect().width,h=d.size*(gt(this)+4*r),p=y.scaleBand().domain(d).range([0,h]),l=y.scaleTime().domain(b),$=(f?Q:K)(p).width(t),_=y.select(this).selectAll("svg").data([1]).join("svg");_.attr("class","timeline").attr("width",t).attr("height",h+40);const S=_.append("g").attr("transform","translate(0,20)"),E=S.append("g").attr("class","y axis").call($);E.selectAll("text").attr("text-anchor",function(g){return g.startsWith(" â€¢")?"middle":"end"}).attr("x",function(g){return g.startsWith(" â€¢")?167:332.5}).style("cursor","pointer").style("font-weight",function(g){return g.startsWith(" â€¢")?"bold":"normal"}).style("background","none").on("click",function(g,N){const J=`https://www.primarysourcecoop.org/publications/jqa/search#q%3D%2Bsubject%3A%22${N.replace(/--/g,"").replace(" ","%20")}%22`;window.open(J,"_blank")}),E.selectAll("g.row").each(function(g){const G=y.select(this).select("text").text();G.startsWith(" â€¢")&&y.select(this).classed("timelineheader",!0).classed(G.replace(/^ â€¢ /,"").replace("  ","").replace(/\s+/g,"-").replace(/[^a-zA-Z0-9-]/g,""),!0).append("text").attr("x",320.5).attr("y",25).text("+").style("text-anchor","end").style("cursor","pointer").style("font-size","20px").attr("fill","black")});let C=$.range();l.range([C[0]+r,C[1]-r]).clamp(!0);const W=y.axisBottom(l),F=S.append("g").attr("class","x axis").attr("transform",q(0,0)).call(W);F.selectAll(".tick text").attr("dy","-1.5em"),F.selectAll(".tick line").attr("y2","-5");const $t=y.axisBottom(l);_.append("g").attr("class","x axis bottom-axis").attr("transform",q(0,h+20)).call($t).selectAll(".tick line").attr("y2","5"),E.on("offset",()=>{C=$.range(),l.range([C[0]+r,C[1]-r]).clamp(!0),W.ticks(Math.min((C[1]-C[0])/70,10)),F.call(W),z.attr("transform",g=>q(l(o(g)),p(M(g)))).selectAll("rect").attr("width",g=>l(c(g))-l(o(g))||u).call(g=>T(g,$)),E.call($.draw_ticks,l.ticks().map(l))}),F.select(".domain").remove(),F.selectAll(".tick line").attr("stroke","#AAA");const vt=l.ticks().map(l);E.call($.draw_ticks,vt);let z=S.selectAll("g.task").data(n);z.exit().remove();const Z=z.enter().append("g").classed("task",!0);Z.append("rect").style("opacity",.7).attr("y",r).style("cursor","pointer").attr("height",p.bandwidth()-2*r).on("mouseover",w.show).on("mouseout",w.hide).on("click",function(g,N){var G=String(N[1]),it=G.replace(" ","%20"),J=N[2],kt=st(J),Mt=N[3],_t=st(Mt),At="https://www.primarysourcecoop.org/publications/jqa/search#q%3D%2Bsubject%3A%22"+it+"%22%20%2Bdate_when%3A%5B"+kt+"%20TO%20"+_t+"%5D%7Crows=20%7Cstart=0%7Chl=true%7Chl.fl=text_merge%7Csort=date_when%20asc%7Cff=person_keyword;subject%7Cfl=id%20index%20title%20filename%20resource_group_name%20date_when%20date_to%20author%20recipient%20person_keyword%20subject%20doc_beginning";window.open(At,"_blank")}).style("fill",I(i,s)),Z.append("text").attr("text-anchor","start").attr("fill",g=>c(g)-o(g)?I(i,s,wt)(g):"black").attr("pointer-events","none").attr("dx",r).attr("y",p.bandwidth()/2).attr("dy","0.32em").text(i),z=z.merge(Z),z.attr("transform",g=>q(C[0],p(M(g)))).selectAll("rect").attr("width",0),z.transition().duration(O).attr("transform",g=>q(l(o(g)),p(M(g)))).selectAll("rect").attr("width",g=>l(c(g))-l(o(g))||u).on("start",Y($)),v&&S.append("path").attr("stroke","red").attr("d","M"+l(new Date)+",0.5V"+h)})}return x.dates=function(a){return arguments.length?(b=a,x):b},x.width=function(a){return arguments.length?(B=a,x):B},x.today=function(a){return arguments.length?(v=a,x):v},x.colors=function(a){return arguments.length?(e=a,x):e},x.padding=function(a){return arguments.length?(r=a,x):r},x.milestone_width=function(a){return arguments.length?(u=a,x):u},x.reversed=function(a){return arguments.length?(f=a,x):f},x.duration=function(a){return arguments.length?(O=a,x):O},x;function k(a,m){const d=I(y.isoParse,y.timeFormat("%Y-%m-%d")),w=`<b>${i(m)}</b><hr style="margin: 2px 0 2px 0">${d(o(m))}`,s=c(m)-o(m)?` - ${d(c(m))}<br>${rt(o(m),c(m))}`:"";return w+s}}j.durationFormat=rt,j.timeline=bt,j.timelineAxisLeft=K,j.timelineAxisRight=Q,j.tooltip=R,Object.keys(P).forEach(e=>{e!=="default"&&!Object.prototype.hasOwnProperty.call(j,e)&&Object.defineProperty(j,e,{enumerable:!0,get:()=>P[e]})}),Object.defineProperty(j,Symbol.toStringTag,{value:"Module"})});
