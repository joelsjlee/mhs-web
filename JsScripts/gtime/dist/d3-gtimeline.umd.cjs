(function(T,H){typeof exports=="object"&&typeof module<"u"?H(exports,require("d3"),require("dayjs")):typeof define=="function"&&define.amd?define(["exports","d3","dayjs"],H):(T=typeof globalThis<"u"?globalThis:T||self,H(T.d3=T.d3||{},T.d3,T.dayjs))})(this,function(T,H,X){"use strict";function ut(t){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const c in t)if(c!=="default"){const i=Object.getOwnPropertyDescriptor(t,c);Object.defineProperty(e,c,i.get?i:{enumerable:!0,get:()=>t[c]})}}return e.default=t,Object.freeze(e)}const l=ut(H),dt="div.tooltip {        position: absolute;        text-align: center;        padding: 5px;        /* font: 12px sans-serif; */        background: white;        border: 1px solid #AAA;        border-radius: 2px;        pointer-events: none;      }";function Z(t){l.select("head").selectAll("#tooltip").data([1]).enter().append("style").attr("id","tooltip").text(dt);const e=l.select("body").append("div").attr("class","tooltip").style("opacity",0);return e.show=function(c){e.transition().duration(100).style("opacity",.95),e.html(t.apply(null,arguments)).style("left",c.pageX+"px").style("top",c.pageY-28+"px")},e.hide=function(c){e.transition().duration(100).style("opacity",0)},e}function ht(t){return l.max(t.nodes().map(e=>e.getComputedTextLength()))}function ft(t){return function(e){return e.length>t?e.slice(0,t-1)+"â€¦":e}}const q=1,mt=2;function K(t,e){let c=["#FFF","#EEE"],i=l.scaleOrdinal(c),f=5,d,$="#AAA",M=40,v=3e3,a;function o(h){let j=e.domain(),D=Z(s=>s),F=l.scaleOrdinal(c),O=l.scaleOrdinal(c.reverse()),b=ft(M),S=h.selectAll(".row").data(j,e).order(),u=S.enter().append("g").attr("class","row"),x=S.exit(),p=S.select("text");S=S.merge(u).attr("transform",s=>"translate(0,"+e(s)+")"),x.remove(),u.append("rect").attr("y",.5).attr("width",v).attr("height",e.bandwidth()).attr("stroke",$).attr("stroke-width",.75).attr("fill",F),u.append("path").attr("stroke",O),p=p.merge(u.append("text").attr("y",e.bandwidth()/2).attr("dy","0.32em").on("mouseover",function(s,r){l.select(this).text()!=r&&D.show(r)}).on("mouseout",D.hide)).text(b),a===void 0&&(a=ht(p)+2*f,a=t===q?v-a:a),d=t===q?[0,a]:[a,v],p.attr("text-anchor",t===q?"start":"end").attr("dx",t===q?f:-f).attr("x",a);const A=function(s,r){a=Math.max(10,Math.min(v-10,a+s.dx)),l.select(this).attr("d","M"+a+",0.5V"+e.range()[1]),p.attr("x",a),d=t===q?[0,a]:[a,v],h.dispatch("offset",{detail:{offset:a}})};h.selectAll("g.y.axis > path").data([1]).join("path").attr("stroke",$).attr("stroke-width",1.75).attr("d","M"+(a+.5)+",0.5V"+e.range()[1]).style("cursor","ew-resize").call(l.drag().on("drag",A))}return o.draw_ticks=function(h,j){h.selectAll(".row").select("path").attr("d",j.map(D=>"M"+D+",1v"+(e.bandwidth()-1)).join(""))},o.scale=function(h){return arguments.length?(e=h,o):e},o.width=function(h){return arguments.length?(v=h,o):v},o.colors=function(h){return arguments.length?(c=h,o):c},o.padding=function(h){return arguments.length?(f=h,o):f},o.range=function(h){return arguments.length?(d=h,o):d},o.trim=function(h){return arguments.length?(M=h,o):M},o.offset=function(h){return arguments.length?(a=h,o):a},o.colorscale=function(h){return arguments.length?(i=h,o):i},o}function Q(t){return K(mt,t)}function U(t){return K(q,t)}var tt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function et(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var nt={exports:{}};(function(t,e){(function(c,i){t.exports=i()})(tt,function(){var c,i,f=1e3,d=6e4,$=36e5,M=864e5,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,a=31536e6,o=2628e6,h=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/,j={years:a,months:o,days:M,hours:$,minutes:d,seconds:f,milliseconds:1,weeks:6048e5},D=function(s){return s instanceof p},F=function(s,r,n){return new p(s,n,r.$l)},O=function(s){return i.p(s)+"s"},b=function(s){return s<0},S=function(s){return b(s)?Math.ceil(s):Math.floor(s)},u=function(s){return Math.abs(s)},x=function(s,r){return s?b(s)?{negative:!0,format:""+u(s)+r}:{negative:!1,format:""+s+r}:{negative:!1,format:""}},p=function(){function s(n,g,w){var m=this;if(this.$d={},this.$l=w,n===void 0&&(this.$ms=0,this.parseFromMilliseconds()),g)return F(n*j[O(g)],this);if(typeof n=="number")return this.$ms=n,this.parseFromMilliseconds(),this;if(typeof n=="object")return Object.keys(n).forEach(function(Y){m.$d[O(Y)]=n[Y]}),this.calMilliseconds(),this;if(typeof n=="string"){var k=n.match(h);if(k){var _=k.slice(2).map(function(Y){return Y!=null?Number(Y):0});return this.$d.years=_[0],this.$d.months=_[1],this.$d.weeks=_[2],this.$d.days=_[3],this.$d.hours=_[4],this.$d.minutes=_[5],this.$d.seconds=_[6],this.calMilliseconds(),this}}return this}var r=s.prototype;return r.calMilliseconds=function(){var n=this;this.$ms=Object.keys(this.$d).reduce(function(g,w){return g+(n.$d[w]||0)*j[w]},0)},r.parseFromMilliseconds=function(){var n=this.$ms;this.$d.years=S(n/a),n%=a,this.$d.months=S(n/o),n%=o,this.$d.days=S(n/M),n%=M,this.$d.hours=S(n/$),n%=$,this.$d.minutes=S(n/d),n%=d,this.$d.seconds=S(n/f),n%=f,this.$d.milliseconds=n},r.toISOString=function(){var n=x(this.$d.years,"Y"),g=x(this.$d.months,"M"),w=+this.$d.days||0;this.$d.weeks&&(w+=7*this.$d.weeks);var m=x(w,"D"),k=x(this.$d.hours,"H"),_=x(this.$d.minutes,"M"),Y=this.$d.seconds||0;this.$d.milliseconds&&(Y+=this.$d.milliseconds/1e3,Y=Math.round(1e3*Y)/1e3);var C=x(Y,"S"),B=n.negative||g.negative||m.negative||k.negative||_.negative||C.negative,V=k.format||_.format||C.format?"T":"",R=(B?"-":"")+"P"+n.format+g.format+m.format+V+k.format+_.format+C.format;return R==="P"||R==="-P"?"P0D":R},r.toJSON=function(){return this.toISOString()},r.format=function(n){var g=n||"YYYY-MM-DDTHH:mm:ss",w={Y:this.$d.years,YY:i.s(this.$d.years,2,"0"),YYYY:i.s(this.$d.years,4,"0"),M:this.$d.months,MM:i.s(this.$d.months,2,"0"),D:this.$d.days,DD:i.s(this.$d.days,2,"0"),H:this.$d.hours,HH:i.s(this.$d.hours,2,"0"),m:this.$d.minutes,mm:i.s(this.$d.minutes,2,"0"),s:this.$d.seconds,ss:i.s(this.$d.seconds,2,"0"),SSS:i.s(this.$d.milliseconds,3,"0")};return g.replace(v,function(m,k){return k||String(w[m])})},r.as=function(n){return this.$ms/j[O(n)]},r.get=function(n){var g=this.$ms,w=O(n);return w==="milliseconds"?g%=1e3:g=w==="weeks"?S(g/j[w]):this.$d[w],g||0},r.add=function(n,g,w){var m;return m=g?n*j[O(g)]:D(n)?n.$ms:F(n,this).$ms,F(this.$ms+m*(w?-1:1),this)},r.subtract=function(n,g){return this.add(n,g,!0)},r.locale=function(n){var g=this.clone();return g.$l=n,g},r.clone=function(){return F(this.$ms,this)},r.humanize=function(n){return c().add(this.$ms,"ms").locale(this.$l).fromNow(!n)},r.valueOf=function(){return this.asMilliseconds()},r.milliseconds=function(){return this.get("milliseconds")},r.asMilliseconds=function(){return this.as("milliseconds")},r.seconds=function(){return this.get("seconds")},r.asSeconds=function(){return this.as("seconds")},r.minutes=function(){return this.get("minutes")},r.asMinutes=function(){return this.as("minutes")},r.hours=function(){return this.get("hours")},r.asHours=function(){return this.as("hours")},r.days=function(){return this.get("days")},r.asDays=function(){return this.as("days")},r.weeks=function(){return this.get("weeks")},r.asWeeks=function(){return this.as("weeks")},r.months=function(){return this.get("months")},r.asMonths=function(){return this.as("months")},r.years=function(){return this.get("years")},r.asYears=function(){return this.as("years")},s}(),A=function(s,r,n){return s.add(r.years()*n,"y").add(r.months()*n,"M").add(r.days()*n,"d").add(r.hours()*n,"h").add(r.minutes()*n,"m").add(r.seconds()*n,"s").add(r.milliseconds()*n,"ms")};return function(s,r,n){c=n,i=n().$utils(),n.duration=function(m,k){var _=n.locale();return F(m,{$l:_},k)},n.isDuration=D;var g=r.prototype.add,w=r.prototype.subtract;r.prototype.add=function(m,k){return D(m)?A(this,m,1):g.bind(this)(m,k)},r.prototype.subtract=function(m,k){return D(m)?A(this,m,-1):w.bind(this)(m,k)}}})})(nt);var pt=nt.exports;const gt=et(pt);var rt={exports:{}};(function(t,e){(function(c,i){t.exports=i()})(tt,function(){return function(c,i,f){c=c||{};var d=i.prototype,$={future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function M(a,o,h,j){return d.fromToBase(a,o,h,j)}f.en.relativeTime=$,d.fromToBase=function(a,o,h,j,D){for(var F,O,b,S=h.$locale().relativeTime||$,u=c.thresholds||[{l:"s",r:44,d:"second"},{l:"m",r:89},{l:"mm",r:44,d:"minute"},{l:"h",r:89},{l:"hh",r:21,d:"hour"},{l:"d",r:35},{l:"dd",r:25,d:"day"},{l:"M",r:45},{l:"MM",r:10,d:"month"},{l:"y",r:17},{l:"yy",d:"year"}],x=u.length,p=0;p<x;p+=1){var A=u[p];A.d&&(F=j?f(a).diff(h,A.d,!0):h.diff(a,A.d,!0));var s=(c.rounding||Math.round)(Math.abs(F));if(b=F>0,s<=A.r||!A.r){s<=1&&p>0&&(A=u[p-1]);var r=S[A.l];D&&(s=D(""+s)),O=typeof r=="string"?r.replace("%d",s):r(s,o,A.l,b);break}}if(o)return O;var n=b?S.future:S.past;return typeof n=="function"?n(O):n.replace("%s",O)},d.to=function(a,o){return M(a,o,this,!0)},d.from=function(a,o){return M(a,o,this)};var v=function(a){return a.$u?f.utc():f()};d.toNow=function(a){return this.to(v(this),a)},d.fromNow=function(a){return this.from(v(this),a)}}})})(rt);var yt=rt.exports;const xt=et(yt);X.extend(gt),X.extend(xt);function st(t,e){return X.duration(e-t).humanize()}function I(){const t=Array.prototype.slice.call(arguments,0);return function(e){return t.reduce((c,i)=>i(c),e)}}function L(t){return function(e){return t===void 0?e:e[t]}}const wt=["#4285f4","#db4437","#f4b400","#0f9d58","#ab47bc","#5e97f5","#e06055","#f5bf26","#33ab71","#b762c6","#00acc1","#ff855f","#9e9d24","#26b8ca","#ff7043"];function bt(t){const e=window.getComputedStyle(t,null).getPropertyValue("font-size");return parseFloat(e)}function $t(t){return t.r*.299+t.g*.587+t.b*.114}function vt(t){return $t(t)>165}function At(t){return vt(l.color(t))?"black":"white"}function ot(t){const e=t.getFullYear(),c=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0");return`${e}${c}${i}`}function N(t,e){return"translate("+t+","+e+")"}function kt(t,e){let i=t.getAttribute("transform").match(/translate\(([\d.-]+),([\d.-]+)\)/);if(i){let f=parseFloat(i[1]),d=parseFloat(i[2]);d+=e,t.setAttribute("transform",`translate(${f},${d})`)}}function it(t,e,c){const f=l.select(t).attr("class");let d=!1;e.selectAll("g.row").each(function($){const v=l.select(this).attr("class");v==f?d=!0:d&&(kt(this,c),Mt(v.split(" ")[1],c))})}function Mt(t,e){document.querySelectorAll(`g.task.${t} rect`).forEach(function(f){let $=parseFloat(f.getAttribute("y"))+e;f.setAttribute("y",$)}),document.querySelectorAll(`g.task.${t} text`).forEach(function(f){let $=parseFloat(f.getAttribute("y"))+e;f.setAttribute("y",$)})}function at(t,e,c){const f=l.select(t).attr("class"),d=[];let $=!1,M=!1;return e.selectAll("g.row").each(function(v){const o=l.select(this).attr("class");o==f?$=!0:$&&o.split(" ")[2]=="timelineheader"?M=!0:$&&!M&&d.push(o.split(" ")[1])}),console.log(`Rows under ${f}:`,d),d.forEach(function(v){document.querySelectorAll(`.${v}`).forEach(function(o){o.style.display=c})}),d.length*38}function ct(t){const e=document.querySelector('path[stroke-width="1.75"]');if(e){let i=e.getAttribute("d").match(/M([\d.-]+),([\d.-]+)V([\d.-]+)/);if(i){let f=parseFloat(i[1]),d=parseFloat(i[2]),M=parseFloat(i[3])+t;e.setAttribute("d",`M${f},${d}V${M}`)}}else console.error('Path with stroke-width="1.75" not found.')}function lt(t){const e=document.querySelector("g.x.axis.bottom-axis");if(e){let i=e.getAttribute("transform").match(/translate\(([\d.-]+),([\d.-]+)\)/);if(i){let f=parseFloat(i[1]),$=parseFloat(i[2])+t;e.setAttribute("transform",`translate(${f},${$})`)}}else console.error("x axis bottom-axis not found.")}function St(){let t=wt,e=5,c=2,i=!1,f=!1,d,$,M=0,v=L(0),a=L(1),o=L(2),h=L(3);function j(u,x){const p=u.select("text"),A=u.select("rect"),s=A.attr("width")-2*e,r=a(x);p.text(r);let n=p.node().getComputedTextLength();if(n>s){const g=s<0?0:s/n,w=Math.floor(r.length*g);p.text(w>2?r.slice(0,w-2)+"â€¦":"")}}function D(u,x,p){const A=u.select("text").node(),s=A.getBBox(),r=p.scale().domain().indexOf(v(x)),n=p.colorscale()(r),g=u.selectAll("rect.bckg").data([x]).join("rect").attr("class","bckg").attr("fill",n).attr("x",s.x-e+c).attr("y",s.y-2).attr("width",s.width+e-c).attr("height",s.height);u.node().insertBefore(g.node(),A)}function F(u,x){u.each(function(p,A){const s=l.select(this.parentNode);h(p)-o(p)?j(s,p):D(s,p,x)})}function O(u){return function(x,p){l.active(this).tween("text",function(){return function(A){F(l.select(this),u)}})}}function b(u){const x=u.datum(),p=new Set(l.map(x,v)),A=new Z(S),s=l.scaleOrdinal(t);d=d||[l.min(x,o),l.max(x,h)],f&&(d=l.extent(d.concat(new Date))),u.each(function(r){const n=$||this.getBoundingClientRect().width,g=p.size*(bt(this)+4*e),w=l.scaleBand().domain(p).range([0,g]),m=l.scaleTime().domain(d),k=(i?U:Q)(w).width(n),_=l.select(this).selectAll("svg").data([1]).join("svg");_.attr("class","timeline").attr("width",n).attr("height",g+40);const Y=_.append("g").attr("transform","translate(0,20)"),C=Y.append("g").attr("class","y axis").call(k);C.selectAll("text").attr("text-anchor",function(y){return y.startsWith(" â€¢")?"middle":"end"}).attr("x",function(y){return y.startsWith(" â€¢")?167:332.5}).style("cursor","pointer").style("font-weight",function(y){return y.startsWith(" â€¢")?"bold":"normal"}).style("background","none").on("click",function(y,E){const G=`https://www.primarysourcecoop.org/publications/jqa/search#q%3D%2Bsubject%3A%22${E.replace(/ â€¢ /g,"").replace(" ","%20")}%22`;window.open(G,"_blank")}),C.selectAll("g.row").each(function(y){const E=l.select(this).datum();l.select(this).classed(l.select(this).datum().replace(/â€¢/g,"").replace(/ /g,"-").replace(/[^a-zA-Z0-9-]/g,""),!0),E.startsWith(" â€¢")&&l.select(this).classed("timelineheader",!0).append("text").attr("x",320.5).attr("y",25).text("-").style("text-anchor","end").style("cursor","pointer").style("font-size","30px").attr("fill","black").style("-ms-user-select","none").style("-webkit-user-select","none").style("user-select","none")}),C.selectAll("g.row.timelineheader text").on("click",function(y,E){const W=l.select(this).text();if(W==="+"){let P=at(this.parentNode,C,"block");it(this.parentNode,C,P),ct(P),lt(P),l.select(this).text()==="+"?l.select(this).text("-").style("font-size","30px"):l.select(this).text("+")}else if(W==="-"){let P=at(this.parentNode,C,"none");it(this.parentNode,C,-P),ct(-P),lt(-P),l.select(this).text()==="-"?l.select(this).text("+").style("font-size","20px"):l.select(this).text("-")}});let B=k.range();m.range([B[0]+e,B[1]-e]).clamp(!0);const V=l.axisBottom(m),R=Y.append("g").attr("class","x axis").attr("transform",N(0,0)).call(V);R.selectAll(".tick text").attr("dy","-1.5em"),R.selectAll(".tick line").attr("y2","-5");const _t=l.axisBottom(m);_.append("g").attr("class","x axis bottom-axis").attr("transform",N(0,g+20)).call(_t).selectAll(".tick line").attr("y2","5"),C.on("offset",()=>{B=k.range(),m.range([B[0]+e,B[1]-e]).clamp(!0),V.ticks(Math.min((B[1]-B[0])/70,10)),R.call(V),z.attr("transform",y=>N(m(o(y)),w(v(y)))).selectAll("rect").attr("width",y=>m(h(y))-m(o(y))||c).call(y=>F(y,k)),C.call(k.draw_ticks,m.ticks().map(m))}),R.select(".domain").remove(),R.selectAll(".tick line").attr("stroke","#AAA");const jt=m.ticks().map(m);C.call(k.draw_ticks,jt);let z=Y.selectAll("g.task").data(r);z.exit().remove();const J=z.enter().append("g").classed("task",!0);J.each(function(y){const E=v(y).replace(/â€¢/g,"").replace(/ /g,"-").replace(/[^a-zA-Z0-9-]/g,"");l.select(this).classed(E,!0)}).append("rect").style("opacity",.7).attr("y",e).style("cursor","pointer").attr("height",w.bandwidth()-2*e).on("mouseover",A.show).on("mouseout",A.hide).on("click",function(y,E){var W=String(E[1]),P=W.replace(" ","%20"),G=E[2],Yt=ot(G),Tt=E[3],Dt=ot(Tt),Ft="https://www.primarysourcecoop.org/publications/jqa/search#q%3D%2Bsubject%3A%22"+P+"%22%20%2Bdate_when%3A%5B"+Yt+"%20TO%20"+Dt+"%5D%7Crows=20%7Cstart=0%7Chl=true%7Chl.fl=text_merge%7Csort=date_when%20asc%7Cff=person_keyword;subject%7Cfl=id%20index%20title%20filename%20resource_group_name%20date_when%20date_to%20author%20recipient%20person_keyword%20subject%20doc_beginning";window.open(Ft,"_blank")}).style("fill",I(a,s)),J.append("text").attr("text-anchor","start").attr("fill",y=>h(y)-o(y)?I(a,s,At)(y):"black").attr("pointer-events","none").attr("dx",e).attr("y",w.bandwidth()/2).attr("dy","0.32em").text(a),z=z.merge(J),z.attr("transform",y=>N(B[0],w(v(y)))).selectAll("rect").attr("width",0),z.transition().duration(M).attr("transform",y=>N(m(o(y)),w(v(y)))).selectAll("rect").attr("width",y=>m(h(y))-m(o(y))||c).on("start",O(k)),f&&Y.append("path").attr("stroke","red").attr("d","M"+m(new Date)+",0.5V"+g)})}return b.dates=function(u){return arguments.length?(d=u,b):d},b.width=function(u){return arguments.length?($=u,b):$},b.today=function(u){return arguments.length?(f=u,b):f},b.colors=function(u){return arguments.length?(t=u,b):t},b.padding=function(u){return arguments.length?(e=u,b):e},b.milestone_width=function(u){return arguments.length?(c=u,b):c},b.reversed=function(u){return arguments.length?(i=u,b):i},b.duration=function(u){return arguments.length?(M=u,b):M},b;function S(u,x){const p=I(l.isoParse,l.timeFormat("%Y-%m-%d")),A=`<b>${a(x)}</b><hr style="margin: 2px 0 2px 0">${p(o(x))}`,s=h(x)-o(x)?` - ${p(h(x))}<br>${st(o(x),h(x))}`:"";return A+s}}T.durationFormat=st,T.timeline=St,T.timelineAxisLeft=Q,T.timelineAxisRight=U,T.tooltip=Z,Object.keys(H).forEach(t=>{t!=="default"&&!Object.prototype.hasOwnProperty.call(T,t)&&Object.defineProperty(T,t,{enumerable:!0,get:()=>H[t]})}),Object.defineProperty(T,Symbol.toStringTag,{value:"Module"})});
